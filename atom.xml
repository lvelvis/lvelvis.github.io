<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>http://lvelvis.github.io</id>
    <title>lvelvis</title>
    <updated>2020-06-17T03:57:48.341Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="http://lvelvis.github.io"/>
    <link rel="self" href="http://lvelvis.github.io/atom.xml"/>
    <subtitle>æ—¶å…‰,æµ“æ·¡ç›¸å®œ;äººå¿ƒ,è¿œè¿‘ç›¸å®‰;è¿™å°±æ˜¯æœ€å¥½çš„ç”Ÿæ´»</subtitle>
    <logo>http://lvelvis.github.io/images/avatar.png</logo>
    <icon>http://lvelvis.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, lvelvis</rights>
    <entry>
        <title type="html"><![CDATA[docker - å†…å­˜ä½¿ç”¨ç‡å·®å¼‚:cgroup memory.usage_in_bytesä¸dockerå®¹å™¨å†…çš„RSS]]></title>
        <id>http://lvelvis.github.io/post/docker-nei-cun-shi-yong-lu-chai-yi-cgroup-memoryusage_in_bytes-yu-docker-rong-qi-nei-de-rss/</id>
        <link href="http://lvelvis.github.io/post/docker-nei-cun-shi-yong-lu-chai-yi-cgroup-memoryusage_in_bytes-yu-docker-rong-qi-nei-de-rss/">
        </link>
        <updated>2020-06-17T03:46:43.000Z</updated>
        <content type="html"><![CDATA[<p>&quot;kubernetes&quot;ï¼ˆv1.10.2ï¼‰è¡¨ç¤ºæˆ‘çš„podï¼ˆåŒ…å«ä¸€ä¸ªå®¹å™¨ï¼‰ä½¿ç”¨äº†å¤§çº¦5GBçš„å†…å­˜ã€‚åœ¨å®¹å™¨å†…éƒ¨ï¼ŒRSSè¯´çš„æ›´åƒ681Mibã€‚ä»»ä½•äººéƒ½èƒ½ç”¨ä»¥ä¸‹æ•°æ®è§£é‡Šå¦‚ä½•ä»681Mibåˆ°5GBå—ï¼ˆæˆ–è€…ç”¨æˆ‘çœç•¥çš„å¦ä¸€ä¸ªå‘½ä»¤æ¥æè¿°å¦‚ä½•å¼¥è¡¥å·®å¼‚ï¼Œæ— è®ºæ˜¯ä»å®¹å™¨è¿˜æ˜¯ä»åœ¨Kubernetesä¸­è¿è¡Œæ­¤å®¹å™¨çš„Dockerä¸»æœºï¼‰ï¼Ÿ<br>
Kubectl Top Podsè¡¨ç¤º5GBï¼š</p>
<pre><code>% kubectl top pods -l app=myapp
NAME                             CPU(cores)   MEMORY(bytes)
myapp-56b947bf6d-2lcr7           39m          5039Mi
</code></pre>
<p>CadvisoræŠ¥å‘Šäº†ç±»ä¼¼çš„æ•°å­—ï¼ˆå¯èƒ½æ¥è‡ªç¨æœ‰ä¸åŒçš„æ—¶é—´ï¼Œå› æ­¤è¯·å¿½ç•¥ç»†å¾®çš„å·®å¼‚ï¼‰ï¼š</p>
<pre><code>container_memory_usage_bytes{pod_name=~&quot;.*myapp.*&quot;}      5309456384

5309456384 / 1024.0 / 1024 ~= 5063 ~= 5039
</code></pre>
<p>åœ¨å®¹å™¨ä¸­ï¼Œæ­¤æ–‡ä»¶ä¼¼ä¹æ˜¯cadvisorè·å–å…¶æ•°æ®çš„ä½ç½®ï¼š</p>
<pre><code># kubectl exec -it myapp-56b947bf6d-2lcr7 bash
meme@myapp-56b947bf6d-2lcr7:/app# cat /sys/fs/cgroup/memory/memory.usage_in_bytes
5309456384
å®¹å™¨ä¸­çš„å¸¸é©»é›†å¤§å°ï¼ˆRSSï¼‰ä¸åŒ¹é…ï¼ˆå°äº1GBï¼‰ï¼š
meme@myapp-56b947bf6d-2lcr7:/app# kb=$(ps aux | grep -v grep | grep -v 'ps aux' | grep -v bash | grep -v awk | grep -v RSS | awk '{print $6}' | awk '{s+=$1} END {printf &quot;%.0f&quot;, s}'); mb=$(expr $kb / 1024); printf &quot;Kb: $kb\nMb: $mb\n&quot;
Kb: 698076
Mb: 681
</code></pre>
<pre><code>å®Œæ•´çš„PS AUXï¼Œä»¥é˜²æœ‰å¸®åŠ©ï¼š
meme@myapp-56b947bf6d-2lcr7:/app# ps aux | grep -v grep | grep -v 'ps aux' | grep -v bash | grep -v awk
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
meme         1  0.0  0.0 151840 10984 ?        Ss   Jun04   0:29 /usr/sbin/apache2 -D FOREGROUND
www-data    10  0.0  0.0 147340  4652 ?        S    Jun04   0:00 /usr/sbin/apache2 -D FOREGROUND
www-data    11  0.0  0.0 148556  4392 ?        S    Jun04   0:16 /usr/sbin/apache2 -D FOREGROUND
www-data    12  0.2  0.0 2080632 11348 ?       Sl   Jun04  31:58 /usr/sbin/apache2 -D FOREGROUND
www-data    13  0.1  0.0 2080384 10980 ?       Sl   Jun04  18:12 /usr/sbin/apache2 -D FOREGROUND
www-data    68  0.3  0.0 349048 94272 ?        Sl   Jun04  47:09 hotapp
www-data   176  0.2  0.0 349624 92888 ?        Sl   Jun04  43:11 hotapp
www-data   179  0.2  0.0 349196 94456 ?        Sl   Jun04  42:20 hotapp
www-data   180  0.3  0.0 349828 95112 ?        Sl   Jun04  44:14 hotapp
www-data   185  0.3  0.0 346644 91948 ?        Sl   Jun04  43:49 hotapp
www-data   186  0.3  0.0 346208 91568 ?        Sl   Jun04  44:27 hotapp
www-data   189  0.2  0.0 350208 95476 ?        Sl   Jun04  41:47 hotapp
</code></pre>
<p>Dockerå®¹å™¨ç»Ÿè®¡APIä¸­çš„å†…å­˜éƒ¨åˆ†ï¼š</p>
<pre><code>curl --unix-socket /var/run/docker.sock 'http:/v1.24/containers/a45fc651e7b12f527b677e6a46e2902786bee6620484922016a135e317a42b4e/stats?stream=false' | jq . # yields:

&quot;memory_stats&quot;: {
  &quot;usage&quot;: 5327712256,
  &quot;max_usage&quot;: 5368344576,
  &quot;stats&quot;: {
    &quot;active_anon&quot;: 609095680,
    &quot;active_file&quot;: 74457088,
    &quot;cache&quot;: 109944832,
    &quot;dirty&quot;: 28672,
    &quot;hierarchical_memory_limit&quot;: 5368709120,
    &quot;inactive_anon&quot;: 1687552,
    &quot;inactive_file&quot;: 29974528,
    &quot;mapped_file&quot;: 1675264,
    &quot;pgfault&quot;: 295316278,
    &quot;pgmajfault&quot;: 77,
    &quot;pgpgin&quot;: 85138921,
    &quot;pgpgout&quot;: 84964308,
    &quot;rss&quot;: 605270016,
    &quot;rss_huge&quot;: 0,
    &quot;shmem&quot;: 5513216,
    &quot;total_active_anon&quot;: 609095680,
    &quot;total_active_file&quot;: 74457088,
    &quot;total_cache&quot;: 109944832,
    &quot;total_dirty&quot;: 28672,
    &quot;total_inactive_anon&quot;: 1687552,
    &quot;total_inactive_file&quot;: 29974528,
    &quot;total_mapped_file&quot;: 1675264,
    &quot;total_pgfault&quot;: 295316278,
    &quot;total_pgmajfault&quot;: 77,
    &quot;total_pgpgin&quot;: 85138921,
    &quot;total_pgpgout&quot;: 84964308,
    &quot;total_rss&quot;: 605270016,
    &quot;total_rss_huge&quot;: 0,
    &quot;total_shmem&quot;: 5513216,
    &quot;total_unevictable&quot;: 0,
    &quot;total_writeback&quot;: 0,
    &quot;unevictable&quot;: 0,
    &quot;writeback&quot;: 0
  },
  &quot;limit&quot;: 5368709120
},
</code></pre>
<p>å¯¹æ–­è¨€çš„æ³¨é‡Šï¼š<br>
æ€»è®¡ï¼ˆmemory.usage_in_bytesï¼‰=rss+ç¼“å­˜<br>
è¯´ï¼š<br>
ç”¨æ³•\uå­—èŠ‚ï¼šä¸ºäº†æé«˜æ•ˆç‡ï¼Œä¸å…¶ä»–å†…æ ¸ç»„ä»¶ä¸€æ ·ï¼Œå†…å­˜ç»„ä½¿ç”¨ä¸€äº›ä¼˜åŒ–<br>
é¿å…ä¸å¿…è¦çš„ç¼“å­˜çº¿é”™è¯¯å…±äº«ã€‚ä½¿ç”¨ç‡å—<br>
æ–¹æ³•ï¼Œä¸æ˜¾ç¤ºå†…å­˜ï¼ˆå’Œäº¤æ¢ï¼‰ä½¿ç”¨çš„â€œç²¾ç¡®â€å€¼ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¨¡ç³Šçš„<br>
æœ‰æ•ˆè®¿é—®çš„å€¼ã€‚ï¼ˆå½“ç„¶ï¼Œå¿…è¦æ—¶ï¼Œå®ƒæ˜¯åŒæ­¥çš„ã€‚ï¼‰<br>
å¦‚æœæ‚¨æƒ³çŸ¥é“æ›´ç²¾ç¡®çš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œåº”è¯¥ä½¿ç”¨rss+cacheï¼ˆ+swapï¼‰<br>
å†…å­˜ä¸­çš„å€¼ã€‚statï¼ˆè§5.2ï¼‰ã€‚<br>
è¯´ï¼š<br>
æ³¨æ„ï¼šåœ¨Linuxä¸Šï¼ŒDocker CLIé€šè¿‡ä»æ€»å†…å­˜ä½¿ç”¨é‡ä¸­å‡å»é¡µé¢ç¼“å­˜ä½¿ç”¨é‡æ¥æŠ¥å‘Šå†…å­˜ä½¿ç”¨æƒ…å†µã€‚APIä¸æ‰§è¡Œè¿™æ ·çš„è®¡ç®—ï¼Œè€Œæ˜¯æä¾›æ€»å†…å­˜ä½¿ç”¨é‡å’Œé¡µé¢ç¼“å­˜çš„æ•°é‡ï¼Œä»¥ä¾¿å®¢æˆ·æœºå¯ä»¥æ ¹æ®éœ€è¦ä½¿ç”¨æ•°æ®ã€‚<br>
å®é™…ä¸Šï¼Œå®¹å™¨ä¸­/sys/fs/cgroup/memory/memory.statä¸­çš„å¤§å¤šæ•°å†…å®¹éƒ½å‡ºç°åœ¨ä¸Šé¢çš„docker stats apiå“åº”ä¸­ï¼ˆä¸åœ¨ä¸åŒæ—¶é—´é‡‡é›†æ ·æœ¬ç•¥æœ‰ä¸åŒï¼ŒæŠ±æ­‰ï¼‰ï¼š</p>
<pre><code>meme@myapp-56b947bf6d-2lcr7:/app# cat /sys/fs/cgroup/memory/memory.stat
cache 119492608
rss 607436800
rss_huge 0
shmem 5525504
mapped_file 1675264
dirty 69632
writeback 0
pgpgin 85573974
pgpgout 85396501
pgfault 296366011
pgmajfault 80
inactive_anon 1687552
active_anon 611213312
inactive_file 32800768
active_file 81166336
unevictable 0
hierarchical_memory_limit 5368709120
total_cache 119492608
total_rss 607436800
total_rss_huge 0
total_shmem 5525504
total_mapped_file 1675264
total_dirty 69632
total_writeback 0
total_pgpgin 85573974
total_pgpgout 85396501
total_pgfault 296366011
total_pgmajfault 80
total_inactive_anon 1687552
total_active_anon 611213312
total_inactive_file 32800768
total_active_file 81166336
total_unevictable 0
</code></pre>
<p>å†…å­˜ä¿¡æ¯æ¥è‡ªï¼š<br>
Limits:<br>
memory:  5Gi<br>
Requests:<br>
memory:   4Gi</p>
<p>ä¸‹é¢æ˜¯å®¹å™¨å†…çš„æç¤ºã€‚åœ¨è¿™ä¸€è¡Œç¨‹åºä¸­ï¼Œæˆ‘è·å–æ‰€æœ‰è¿›ç¨‹IDï¼Œåœ¨å®ƒä»¬ä¸Šè¿è¡Œpmap-xï¼Œå¹¶ä»pmapç»“æœä¸­æå–kbytesåˆ—ã€‚æ€»çš„ç»“æœæ˜¯256å…†å­—èŠ‚ï¼ˆè¿œå°äºPSçš„RSSï¼Œæˆ‘è®¤ä¸ºéƒ¨åˆ†åŸå› æ˜¯è®¸å¤šè¿›ç¨‹æ²¡æœ‰ä»PMAP-Xè¿”å›è¾“å‡ºï¼‰ï¼š</p>
<pre><code>ps aux | awk '{print $2}' | grep -v PID | xargs sudo pmap -x | grep total | grep -v grep | awk '{print $3}' | awk '{s+=$1} END {printf &quot;%.0f&quot;, s}'; echo
256820
</code></pre>
<p>https://github.com/google/cadvisor/issues/638ä¸­æåˆ°äº†ã€‚å®ƒæ£€æŸ¥kubectl describe pod <pod>å’Œpmapã€‚è¿™é‡Œæ²¡æœ‰ç…§æ˜ï¼ˆåŒæ ·ï¼Œå®ƒä¼¼ä¹å¿½ç•¥äº†ä¸€äº›è¿‡ç¨‹ï¼‰ï¼š</p>
<pre><code># python ps_mem.py
Private  +   Shared  =  RAM used    Program

  1.7 MiB +   1.0 MiB =   2.7 MiB   apache2
  2.0 MiB +   1.0 MiB =   3.0 MiB   bash (3)
---------------------------------
                          5.7 MiB
=================================
</code></pre>
<p>æœ€ä½³ç­”æ¡ˆ</p>
<pre><code>æœ‰ä¸€ä»¶äº‹æˆ‘æ²¡çœ‹åˆ°æ‚¨æ£€æŸ¥è¿™é‡Œæ˜¯å†…æ ¸å†…å­˜ã€‚è¿™åœ¨memory.usage_in_byteså›¾ä¸­ä¹Ÿæœ‰è¯´æ˜ï¼Œä½†åœ¨memory.statä¸­æ²¡æœ‰å‡ºç°ã€‚æ‚¨å¯ä»¥é€šè¿‡æŸ¥çœ‹/sys/fs/cgroup/memory/memory.kmem.usage_in_bytesæ‰¾åˆ°å®ƒã€‚
æœ‰ä¸€æ¬¡ï¼Œæˆ‘çœ‹åˆ°æˆ‘ä»¬çš„ä¸€ä¸ª.NETæ ¸å¿ƒåº”ç”¨ç¨‹åºä¹Ÿå‘ç”Ÿäº†ç±»ä¼¼çš„äº‹æƒ…ï¼Œä½†æˆ‘ä¸çŸ¥é“åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼ˆå¯èƒ½æ˜¯.NETæ ¸å¿ƒå†…å­˜æ³„æ¼ï¼Œå› ä¸ºå®ƒæ˜¯æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ— æ³•æ§åˆ¶çš„éæ‰˜ç®¡å†…å­˜ï¼‰ã€‚è¿™å°†å–å†³äºæ‚¨çš„åº”ç”¨ç¨‹åºä½¿ç”¨æ˜¯å¦æ­£å¸¸ï¼Œä½†å°±cgroupsè€Œè¨€ï¼Œæˆ‘ç›¸ä¿¡å†…æ ¸å†…å­˜ä½¿ç”¨åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸å—çº¦æŸçš„ã€‚
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[golangç¬”è®°-go modä¸go vendor]]></title>
        <id>http://lvelvis.github.io/post/golang-bi-ji-go-mod-yu-go-vendor/</id>
        <link href="http://lvelvis.github.io/post/golang-bi-ji-go-mod-yu-go-vendor/">
        </link>
        <updated>2020-06-10T08:40:20.000Z</updated>
        <content type="html"><![CDATA[<h1 id="go-mod-ä½¿ç”¨">go mod ä½¿ç”¨</h1>
<p>è§£å†³çš„é—®é¢˜æ˜¯golangä¸å†ä¾èµ–gopathçš„è®¾ç½®ï¼Œä¸‹è½½ä¸‹æ¥çš„åŒ…å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚<br>
go mod init ./<br>
go build main.go æˆ– go build -mod=vendor main.go<br>
go mod vendor #å°†åŒ…æ‰“åˆ°vendoræ–‡ä»¶å¤¹ä¸‹</p>
<h1 id="go-vendor">go vendor</h1>
<p>ç®¡ç†Golangé¡¹ç›®ä¾èµ–ï¼Œåº”è¯¥æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„ï¼Œä½†æ˜¯æ¯”è¾ƒå¥½ç”¨ã€‚</p>
<p>å®‰è£…<br>
go get -u github.com/kardianos/govendor</p>
<p>ä½¿ç”¨ä¸€å¥—è¿æ‹›ï¼š</p>
<pre><code>govendor init # åˆ›å»ºvendorç›®å½•ï¼Œåˆ›å»ºvendor.jsonæ–‡ä»¶  
govendor add +external #ç”Ÿæˆä¾èµ–åŒ…  
govendor update +vendor # æ›´æ–°vendorçš„åŒ…å‘½ä»¤  
çŠ¶æ€	ç¼©å†™çŠ¶æ€	å«ä¹‰
+local	l	æœ¬åœ°åŒ…ï¼Œå³é¡¹ç›®è‡ªèº«çš„åŒ…ç»„ç»‡
+external	e	å¤–éƒ¨åŒ…ï¼Œå³è¢« $GOPATH ç®¡ç†ï¼Œä½†ä¸åœ¨ vendor ç›®å½•ä¸‹
+vendor	v	å·²è¢« govendor ç®¡ç†ï¼Œå³åœ¨ vendor ç›®å½•ä¸‹
+std	s	æ ‡å‡†åº“ä¸­çš„åŒ…
+unused	u	æœªä½¿ç”¨çš„åŒ…ï¼Œå³åŒ…åœ¨ vendor ç›®å½•ä¸‹ï¼Œä½†é¡¹ç›®å¹¶æ²¡æœ‰ç”¨åˆ°
+missing	m	ä»£ç å¼•ç”¨äº†ä¾èµ–åŒ…ï¼Œä½†è¯¥åŒ…å¹¶æ²¡æœ‰æ‰¾åˆ°
+program	p	ä¸»ç¨‹åºåŒ…ï¼Œæ„å‘³ç€å¯ä»¥ç¼–è¯‘ä¸ºæ‰§è¡Œæ–‡ä»¶
+outside	 	å¤–éƒ¨åŒ…å’Œç¼ºå¤±çš„åŒ…
+all	 	æ‰€æœ‰çš„åŒ…
å‘½ä»¤	åŠŸèƒ½
init	åˆå§‹åŒ– vendor ç›®å½•
list	åˆ—å‡ºæ‰€æœ‰çš„ä¾èµ–åŒ…
add	æ·»åŠ åŒ…åˆ° vendor ç›®å½•ï¼Œå¦‚ govendor add +external æ·»åŠ æ‰€æœ‰å¤–éƒ¨åŒ…
add PKG_PATH	æ·»åŠ æŒ‡å®šçš„ä¾èµ–åŒ…åˆ° vendor ç›®å½•
update	ä» $GOPATH æ›´æ–°ä¾èµ–åŒ…åˆ° vendor ç›®å½•
remove	ä» vendor ç®¡ç†ä¸­åˆ é™¤ä¾èµ–
status	åˆ—å‡ºæ‰€æœ‰ç¼ºå¤±ã€è¿‡æœŸå’Œä¿®æ”¹è¿‡çš„åŒ…
fetch	æ·»åŠ æˆ–æ›´æ–°åŒ…åˆ°æœ¬åœ° vendor ç›®å½•
sync	æœ¬åœ°å­˜åœ¨ vendor.json æ—¶å€™æ‹‰å»ä¾èµ–åŒ…ï¼ŒåŒ¹é…æ‰€è®°å½•çš„ç‰ˆæœ¬
get	ç±»ä¼¼ go get ç›®å½•ï¼Œæ‹‰å–ä¾èµ–åŒ…åˆ° vendor ç›®å½•
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[golangç¬”è®°-zipæ—¥å¿—ä½¿ç”¨]]></title>
        <id>http://lvelvis.github.io/post/golang-bi-ji-zip-ri-zhi-shi-yong/</id>
        <link href="http://lvelvis.github.io/post/golang-bi-ji-zip-ri-zhi-shi-yong/">
        </link>
        <updated>2020-06-03T06:17:23.000Z</updated>
        <content type="html"><![CDATA[<p>åœ¨beegoä¸­ä½¿ç”¨zapç®¡ç†æ—¥å¿—ï¼Œå¾ˆæ–¹ä¾¿ğŸ‘<br>
éœ€è¦åœ¨conf/app.confå®šä¹‰å‡ ä¸ªå‚æ•°</p>
<pre><code>appname = web-terminal
httpport = &quot;9600&quot;

runmode = &quot;prod&quot;
LogLevel = &quot;info&quot;
autorender = true
recoverpanic = false
copyrequestbody = true
viewspath = &quot;static&quot;
LogPath = &quot;logs/k8s-websocket.log&quot;
</code></pre>
<p>logger.go</p>
<pre><code>package controllers

import (
	&quot;os&quot;

	&quot;github.com/astaxie/beego&quot;
	&quot;github.com/natefinch/lumberjack&quot;
	&quot;go.uber.org/zap&quot;
	&quot;go.uber.org/zap/zapcore&quot;
)

//MyLoggeråˆå§‹åŒ–zaploggeræ—¥å¿—åº“
var MyLogger *zap.Logger

func initLogger(logpath string, loglevel string) *zap.Logger {

	// è®¾ç½®æ—¥å¿—çº§åˆ«
	var level zapcore.Level
	switch loglevel {
	case &quot;debug&quot;:
		level = zap.DebugLevel
	case &quot;info&quot;:
		level = zap.InfoLevel
	case &quot;error&quot;:
		level = zap.ErrorLevel
	default:
		level = zap.InfoLevel
	}

	hook := lumberjack.Logger{
		Filename:   logpath, // æ—¥å¿—æ–‡ä»¶è·¯å¾„
		MaxSize:    20,      // æ¯ä¸ªæ—¥å¿—æ–‡ä»¶ä¿å­˜çš„æœ€å¤§å°ºå¯¸ å•ä½ï¼šM
		MaxBackups: 10,      // æ—¥å¿—æ–‡ä»¶æœ€å¤šä¿å­˜å¤šå°‘ä¸ªå¤‡ä»½
		MaxAge:     7,       // æ–‡ä»¶æœ€å¤šä¿å­˜å¤šå°‘å¤©
		Compress:   true,    // æ˜¯å¦å‹ç¼©
	}

	encoderConfig := zapcore.EncoderConfig{
		TimeKey:        &quot;time&quot;,
		LevelKey:       &quot;level&quot;,
		NameKey:        &quot;logger&quot;,
		CallerKey:      &quot;linenum&quot;,
		MessageKey:     &quot;msg&quot;,
		StacktraceKey:  &quot;stacktrace&quot;,
		LineEnding:     zapcore.DefaultLineEnding,
		EncodeLevel:    zapcore.LowercaseLevelEncoder,  // å°å†™ç¼–ç å™¨
		EncodeTime:     zapcore.ISO8601TimeEncoder,     // ISO8601 UTC æ—¶é—´æ ¼å¼
		EncodeDuration: zapcore.SecondsDurationEncoder, //
		EncodeCaller:   zapcore.ShortCallerEncoder,     // çŸ­è·¯å¾„ç¼–ç å™¨
		EncodeName:     zapcore.FullNameEncoder,
	}

	core := zapcore.NewCore(
		zapcore.NewJSONEncoder(encoderConfig),                                           // ç¼–ç å™¨é…ç½®
		zapcore.NewMultiWriteSyncer(zapcore.AddSync(os.Stdout), zapcore.AddSync(&amp;hook)), // æ‰“å°åˆ°æ§åˆ¶å°å’Œæ–‡ä»¶
		level, // æ—¥å¿—çº§åˆ«
	)

	// å¼€å¯å¼€å‘æ¨¡å¼ï¼Œå †æ ˆè·Ÿè¸ª
	caller := zap.AddCaller()
	// å¼€å¯æ–‡ä»¶åŠè¡Œå·
	development := zap.Development()

	// è®¾ç½®åˆå§‹åŒ–å­—æ®µ
	filed := zap.Fields(zap.String(&quot;serviceName&quot;, &quot;k8s-websocket-dashboard&quot;))
	// æ„é€ æ—¥å¿—
	logger := zap.New(core, caller, development, filed)

	logger.Info(&quot;initlog åˆå§‹åŒ–æˆåŠŸ&quot;)
	return logger
}

// åˆå§‹åŒ–æ—¥å¿—
func init() {
	logPath := beego.AppConfig.String(&quot;LogPath&quot;)
	loglevel := beego.AppConfig.String(&quot;LogLevel&quot;)
	MyLogger = initLogger(logPath, loglevel)
}
</code></pre>
<p>æ—¥å¿—è¾“å‡ºï¼š</p>
<pre><code>{&quot;level&quot;:&quot;info&quot;,&quot;time&quot;:&quot;2020-06-02T19:41:37.799+0800&quot;,&quot;linenum&quot;:&quot;controllers/logger.go:59&quot;,&quot;msg&quot;:&quot;log åˆå§‹åŒ–æˆåŠŸ&quot;,&quot;serviceName&quot;:&quot;k8s-websocket-dashboard&quot;}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[golangç¬”è®°-beegoè·å–urlè¯·æ±‚çš„å‚æ•°]]></title>
        <id>http://lvelvis.github.io/post/golang-bi-ji-beego-huo-qu-url-qing-qiu-de-can-shu/</id>
        <link href="http://lvelvis.github.io/post/golang-bi-ji-beego-huo-qu-url-qing-qiu-de-can-shu/">
        </link>
        <updated>2020-06-02T04:00:50.000Z</updated>
        <content type="html"><![CDATA[<h1 id="è·å–å‚æ•°">è·å–å‚æ•°</h1>
<p>æˆ‘ä»¬ç»å¸¸éœ€è¦è·å–ç”¨æˆ·ä¼ é€’çš„æ•°æ®ï¼ŒåŒ…æ‹¬Getã€POSTç­‰æ–¹å¼çš„è¯·æ±‚ï¼Œbeegoé‡Œé¢ä¼šè‡ªåŠ¨è§£æè¿™äº›æ•°æ®ï¼Œä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è·å–æ•°æ®ï¼š</p>
<p>GetString(key string) string<br>
GetStrings(key string) []string<br>
GetInt(key string) (int64, error)<br>
GetBool(key string) (bool, error)<br>
GetFloat(key string) (float64, error)<br>
ç¤ºä¾‹1ï¼š</p>
<pre><code>func (this *MainController) Post() {
    jsoninfo := &lt;strong&gt;this.GetString&lt;/strong&gt;(&quot;jsoninfo&quot;)
    if jsoninfo == &quot;&quot; {
        this.Ctx.WriteString(&quot;jsoninfo is empty&quot;)
        return
    }
}```
å¦‚æœä½ éœ€è¦çš„æ•°æ®å¯èƒ½æ˜¯å…¶å®ƒç±»å‹ï¼Œä¾‹å¦‚æ˜¯intç±»å‹è€Œä¸æ˜¯int64ï¼Œé‚£ä¹ˆä½ éœ€è¦è¿™æ ·å¤„ç†ï¼š

ç¤ºä¾‹2ï¼š
</code></pre>
<p>func (this *MainController) Post() {<br>
id := <strong>this.Input().Get</strong>(&quot;id&quot;)<br>
intid, err := <strong>strconv.Atoi</strong>(id)<br>
}```<br>
æ›´å¤šå…¶ä»–çš„requestçš„ä¿¡æ¯ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡this.Ctx.Requestè·å–ä¿¡æ¯ã€‚</p>
<p>å…³äºè¯¥å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•å¯å‚è€ƒrequestå®˜æ–¹æ‰‹å†Œhttps://gowalker.org/net/http#Request</p>
<h1 id="ç›´æ¥è§£æåˆ°struct">ç›´æ¥è§£æåˆ°struct</h1>
<p>å¦‚æœè¦æŠŠè¡¨å•é‡Œçš„å†…å®¹èµ‹å€¼åˆ°ä¸€ä¸ªstructé‡Œï¼Œé™¤äº†ç”¨ä¸Šé¢çš„æ–¹æ³•ä¸€ä¸ªä¸€ä¸ªè·å–å†èµ‹å€¼ä¹‹å¤–ï¼Œ<br>
beegoæä¾›äº†é€šè¿‡å¦å¤–ä¸€ä¸ªæ›´ä¾¿æ·çš„æ–¹å¼ï¼Œå°±æ˜¯é€šè¿‡structçš„å­—æ®µåæˆ–tagä¸è¡¨å•å­—æ®µå¯¹åº”ç›´æ¥è§£æåˆ°structã€‚</p>
<p>ç¤ºä¾‹3ï¼š</p>
<p>å®šä¹‰struct</p>
<pre><code>type user struct {
    Id    int         `form:&quot;-&quot;`
    Name  interface{} `form:&quot;&lt;strong&gt;username&lt;/strong&gt;&quot;`
    Age   int         `form:&quot;&lt;strong&gt;age&lt;/strong&gt;&quot;`
    Email string
}
</code></pre>
<p>è¡¨å•</p>
<pre><code>&lt;form id=&quot;&lt;strong&gt;user&lt;/strong&gt;&quot;&gt;
    åå­—ï¼š&lt;input name=&quot;&lt;strong&gt;username&lt;/strong&gt;&quot; type=&quot;text&quot; /&gt;
    å¹´é¾„ï¼š&lt;input name=&quot;&lt;strong&gt;age&lt;/strong&gt;&quot; type=&quot;text&quot; /&gt;
    é‚®ç®±ï¼š&lt;input name=&quot;Email&quot; type=&quot;text&quot; /&gt;
    &lt;input type=&quot;submit&quot; value=&quot;æäº¤&quot; /&gt;
&lt;/form&gt;
</code></pre>
<p>controlleré‡Œè§£æ</p>
<pre><code>func (this *MainController) Post() {
    u := &lt;strong&gt;user{}&lt;/strong&gt;
    if err := this.ParseForm(&lt;strong&gt;&amp;u&lt;/strong&gt;); err != nil {
        //handle error
    }
}ã€€ã€€
</code></pre>
<p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼š</p>
<p>ï¼ˆ1ï¼‰structTag formçš„å®šä¹‰å’Œrenderformæ–¹æ³•å…±ç”¨ä¸€ä¸ªæ ‡ç­¾ã€‚</p>
<p>ï¼ˆ2ï¼‰å®šä¹‰structæ—¶ï¼Œå­—æ®µååå¦‚æœæœ‰formè¿™ä¸ªtagï¼Œåˆ™ä¼šæŠŠformè¡¨å•é‡Œçš„nameå’Œtagçš„åå­—ä¸€æ ·çš„å­—æ®µèµ‹å€¼ç»™è¿™ä¸ªå­—æ®µï¼Œ</p>
<p>å¦åˆ™å°±ä¼šæŠŠformè¡¨å•é‡Œä¸å­—æ®µåä¸€æ ·çš„è¡¨å•å†…å®¹èµ‹å€¼ç»™è¿™ä¸ªå­—æ®µã€‚</p>
<p>ä¾‹å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä¼šæŠŠè¡¨å•ä¸­çš„usernameå’Œageåˆ†åˆ«èµ‹å€¼ç»™useré‡Œçš„Nameå’ŒAgeå­—æ®µï¼Œè€ŒEmailé‡Œçš„å†…å®¹åˆ™ä¼šèµ‹å€¼ç»™Emailè¿™ä¸ªå­—æ®µã€‚</p>
<p>ï¼ˆ3ï¼‰è°ƒç”¨Controller PraseFormè¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œä¼ å…¥çš„å‚æ•°å¿…é¡»ä¸ºä¸€ä¸ªstructçš„æŒ‡é’ˆï¼Œå¦åˆ™å¯¹structçš„èµ‹å€¼ä¸ä¼šæˆåŠŸå¹¶è¿”å›xx must be a struct pointerçš„é”™è¯¯ã€‚</p>
<p>ï¼ˆ4ï¼‰å¦‚æœè¦å¿½ç•¥ä¸€ä¸ªå­—æ®µï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€æ˜¯ï¼šå­—æ®µåå°å†™å¼€å¤´ï¼ŒäºŒæ˜¯ï¼šformæ ‡ç­¾è®¾ç½®ä¸º_</p>
<h1 id="è·å–request-bodyé‡Œçš„å†…å®¹">è·å–Request Bodyé‡Œçš„å†…å®¹</h1>
<p>åœ¨APIçš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šç”¨åˆ°JSONæˆ–XMLæ¥ä½œä¸ºæ•°æ®äº¤äº’çš„æ ¼å¼ï¼Œå¦‚ä½•åœ¨beegoä¸­è·å–Request Bodyé‡Œçš„JSONæˆ–XMLçš„æ•°æ®å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œåœ¨é…ç½®æ–‡ä»¶é‡Œè®¾ç½®copyrequestbody = true</p>
<p>å…¶æ¬¡ï¼Œåœ¨Controllerä¸­ï¼š</p>
<p>ç¤ºä¾‹4ï¼š</p>
<pre><code>func (this *ObjectController) Post() {
    var ob models.Object
    var err error
    if err = json.Unmarshal(this.Ctx.Input.RequestBody, &amp;ob); err == nil {
        objectid := models.AddOne(ob)
        this.Data[&quot;json&quot;] = &quot;{\&quot;ObjectId\&quot;:\&quot;&quot; + objectid + &quot;\&quot;}&quot;
    } else {
        this.Data[&quot;json&quot;] = err.Error()
    }
    this.ServeJSON()
}
</code></pre>
<p></p>
<h1 id="æ–‡ä»¶ä¸Šä¼ ">æ–‡ä»¶ä¸Šä¼ </h1>
<p>åœ¨beegoä¸­ä½ å¯ä»¥å¾ˆå®¹æ˜“çš„å¤„ç†æ–‡ä»¶ä¸Šä¼ ï¼Œå°±æ˜¯åˆ«å¿˜è®°åœ¨ä½ çš„formè¡¨å•ä¸­å¢åŠ â€œenctype=&quot;multipart/form-dataâ€ï¼Œå¦åˆ™ä½ çš„æµè§ˆå™¨ä¸ä¼šä¼ è¾“ä½ çš„ä¸Šä¼ æ–‡ä»¶ã€‚</p>
<p>æ–‡ä»¶ä¸Šä¼ ä¹‹åä¸€èˆ¬æ˜¯æ”¾åœ¨ç³»ç»Ÿçš„å†…å­˜é‡Œé¢ï¼Œå¦‚æœæ–‡ä»¶çš„sizeå¤§äºè®¾ç½®çš„ç¼“å­˜å¤§å°ï¼Œé‚£ä¹ˆå°±æ”¾åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œ</p>
<p>é»˜è®¤çš„ç¼“å­˜å†…å­˜æ˜¯64Mï¼Œä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼æ¥è°ƒæ•´è¿™ä¸ªç¼“å­˜å†…å­˜çš„å¤§å°ã€‚</p>
<p>beego.MaxMemory = 1&lt;&lt;22<br>
æˆ–è€…åœ¨é…ç½®æ–‡ä»¶ä¸­é€šè¿‡å¦‚ä¸‹è®¾ç½®ï¼š</p>
<p>maxmemory = 1&lt;&lt;22<br>
Beegoæä¾›äº†ä¸¤ä¸ªå¾ˆæ–¹ä¾¿çš„æ–¹æ³•æ¥å¤„ç†æ–‡ä»¶ä¸Šä¼ ï¼š</p>
<p>ï¼ˆ1ï¼‰GetFile(key string) (multipart.File, *multipart.FileHeader, error)</p>
<p>è¯¥æ–¹æ³•ä¸»è¦ç”¨äºç”¨æˆ·è¯»å–è¡¨å•ä¸­çš„æ–‡ä»¶åthe_fileï¼Œç„¶åè¿”å›ç›¸åº”çš„ä¿¡æ¯ï¼Œç”¨æˆ·æ ¹æ®è¿™äº›å˜é‡æ¥å¤„ç†æ–‡ä»¶ä¸Šä¼ ï¼šè¿‡æ»¤ã€ä¿å­˜æ–‡ä»¶ç­‰ã€‚</p>
<p>ï¼ˆ2ï¼‰SaveToFile(fromfile, tofile string) error</p>
<p>è¯¥æ–¹æ³•æ˜¯åœ¨GetFileçš„åŸºç¡€ä¸Šå®ç°äº†å¿«é€Ÿä¿å­˜çš„åŠŸèƒ½ï¼Œfromfileæ˜¯æäº¤çš„æ—¶å€™htmlè¡¨å•ä¸­çš„nameã€‚</p>
<p>ç¤ºä¾‹5</p>
<p>è¡¨å•ï¼š</p>
<pre><code>&lt;form enctype=&quot;multipart/form-data&quot; method=&quot;post&quot;&gt;
    &lt;input type=&quot;file&quot; name=&quot;uploadname&quot; /&gt;
    &lt;input type=&quot;submit&quot;&gt;
&lt;/form&gt;
</code></pre>
<p>Controllerä¸­ä»£ç ï¼š</p>
<pre><code>func (c *FormController) Post() {
    f, h, err := c.GetFile(&quot;uploadname&quot;)
    if err != nil {
        log.Fatal(&quot;getfile err &quot;, err)
    }
    defer f.Close()
    c.SaveToFile(&quot;uploadname&quot;, &quot;static/upload/&quot; + h.Filename) // ä¿å­˜ä½ç½®åœ¨ static/upload, æ²¡æœ‰æ–‡ä»¶å¤¹è¦å…ˆåˆ›å»º
     
}
</code></pre>
<h1 id="æ•°æ®ç»‘å®š">æ•°æ®ç»‘å®š</h1>
<p>æ”¯æŒä»ç”¨æˆ·è¯·æ±‚ä¸­ç›´æ¥æ•°æ®bindåˆ°æŒ‡å®šçš„å¯¹è±¡ã€‚</p>
<p>ç¤ºä¾‹6ï¼š</p>
<pre><code>var id int
this.Ctx.Input.Bind(&amp;id, &quot;id&quot;)  //id ==123
 
var isok bool
this.Ctx.Input.Bind(&amp;isok, &quot;isok&quot;)  //isok ==true
 
var ft float64
this.Ctx.Input.Bind(&amp;ft, &quot;ft&quot;)  //ft ==1.2
 
ol := make([]int, 0, 2)
this.Ctx.Input.Bind(&amp;ol, &quot;ol&quot;)  //ol ==[1 2]
 
ul := make([]string, 0, 2)
this.Ctx.Input.Bind(&amp;ul, &quot;ul&quot;)  //ul ==[str array]
 
user struct{Name}
this.Ctx.Input.Bind(&amp;user, &quot;user&quot;)  //user =={Name:&quot;astaxie&quot;}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[golangç¬”è®°-jsonæ•°æ®è§£æï¼šMarshalä¸Unmarshal]]></title>
        <id>http://lvelvis.github.io/post/golang-bi-ji-json-shu-ju-jie-xi-marshal-yu-unmarshal/</id>
        <link href="http://lvelvis.github.io/post/golang-bi-ji-json-shu-ju-jie-xi-marshal-yu-unmarshal/">
        </link>
        <updated>2020-05-28T10:15:31.000Z</updated>
        <content type="html"><![CDATA[<h1 id="ç®€ä»‹">ç®€ä»‹</h1>
<p>Json(Javascript Object Nanotation)æ˜¯ä¸€ç§æ•°æ®äº¤æ¢æ ¼å¼ï¼Œå¸¸ç”¨äºå‰åç«¯æ•°æ®ä¼ è¾“ã€‚ä»»æ„ä¸€ç«¯å°†æ•°æ®è½¬æ¢æˆjson å­—ç¬¦ä¸²ï¼Œå¦ä¸€ç«¯å†å°†è¯¥å­—ç¬¦ä¸²è§£ææˆç›¸åº”çš„æ•°æ®ç»“æ„ï¼Œå¦‚stringç±»å‹ï¼Œstrcutå¯¹è±¡ç­‰ã€‚</p>
<p>goè¯­è¨€æœ¬èº«ä¸ºæˆ‘ä»¬æä¾›äº†jsonçš„å·¥å…·åŒ…â€encoding/jsonâ€ã€‚<br>
æ›´å¤šçš„ä½¿ç”¨æ–¹å¼ï¼Œå¯ä»¥å‚è€ƒï¼šhttps://studygolang.com/articles/6742</p>
<h1 id="å®ç°">å®ç°</h1>
<p>Json Marshalï¼šå°†æ•°æ®ç¼–ç æˆjsonå­—ç¬¦ä¸²<br>
çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­</p>
<pre><code>type Stu struct {
    Name  string `json:&quot;name&quot;`
    Age   int
    HIgh  bool
    sex   string
    Class *Class `json:&quot;class&quot;`
}

type Class struct {
    Name  string
    Grade int
}

func main() {
    //å®ä¾‹åŒ–ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œç”¨äºç”Ÿæˆjsonå­—ç¬¦ä¸²
    stu := Stu{
        Name: &quot;å¼ ä¸‰&quot;,
        Age:  18,
        HIgh: true,
        sex:  &quot;ç”·&quot;,
    }

    //æŒ‡é’ˆå˜é‡
    cla := new(Class)
    cla.Name = &quot;1ç­&quot;
    cla.Grade = 3
    stu.Class=cla

    //Marshalå¤±è´¥æ—¶err!=nil
    jsonStu, err := json.Marshal(stu)
    if err != nil {
        fmt.Println(&quot;ç”Ÿæˆjsonå­—ç¬¦ä¸²é”™è¯¯&quot;)
    }

    //jsonStuæ˜¯[]byteç±»å‹ï¼Œè½¬åŒ–æˆstringç±»å‹ä¾¿äºæŸ¥çœ‹
    fmt.Println(string(jsonStu))
}
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code>{&quot;name&quot;:&quot;å¼ ä¸‰&quot;,&quot;Age&quot;:18,&quot;HIgh&quot;:true,&quot;class&quot;:{&quot;Name&quot;:&quot;1ç­&quot;,&quot;Grade&quot;:3}}
</code></pre>
<p>ä»ç»“æœä¸­å¯ä»¥çœ‹å‡º</p>
<p>åªè¦æ˜¯å¯å¯¼å‡ºæˆå‘˜ï¼ˆå˜é‡é¦–å­—æ¯å¤§å†™ï¼‰ï¼Œéƒ½å¯ä»¥è½¬æˆjsonã€‚å› æˆå‘˜å˜é‡sexæ˜¯ä¸å¯å¯¼å‡ºçš„ï¼Œæ•…æ— æ³•è½¬æˆjsonã€‚</p>
<p>å¦‚æœå˜é‡æ‰“ä¸Šäº†jsonæ ‡ç­¾ï¼Œå¦‚Nameæ—è¾¹çš„ <code>json:&quot;name&quot;</code> ï¼Œé‚£ä¹ˆè½¬åŒ–æˆçš„json keyå°±ç”¨è¯¥æ ‡ç­¾â€œnameâ€ï¼Œå¦åˆ™å–å˜é‡åä½œä¸ºkeyï¼Œå¦‚â€œAgeâ€ï¼Œâ€œHIghâ€ã€‚</p>
<p>boolç±»å‹ä¹Ÿæ˜¯å¯ä»¥ç›´æ¥è½¬æ¢ä¸ºjsonçš„valueå€¼ã€‚Channelï¼Œ complex ä»¥åŠå‡½æ•°ä¸èƒ½è¢«ç¼–ç jsonå­—ç¬¦ä¸²ã€‚å½“ç„¶ï¼Œå¾ªç¯çš„æ•°æ®ç»“æ„ä¹Ÿä¸è¡Œï¼Œå®ƒä¼šå¯¼è‡´marshalé™·å…¥æ­»å¾ªç¯ã€‚</p>
<p>æŒ‡é’ˆå˜é‡ï¼Œç¼–ç æ—¶è‡ªåŠ¨è½¬æ¢ä¸ºå®ƒæ‰€æŒ‡å‘çš„å€¼ï¼Œå¦‚claå˜é‡ã€‚<br>
ï¼ˆå½“ç„¶ï¼Œä¸ä¼ æŒ‡é’ˆï¼ŒStu structçš„æˆå‘˜Classå¦‚æœæ¢æˆClass structç±»å‹ï¼Œæ•ˆæœä¹Ÿæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚åªä¸è¿‡æŒ‡é’ˆæ›´å¿«ï¼Œä¸”èƒ½èŠ‚çœå†…å­˜ç©ºé—´ã€‚ï¼‰</p>
<p>æœ€åï¼Œå¼ºè°ƒä¸€å¥ï¼šjsonç¼–ç æˆå­—ç¬¦ä¸²åå°±æ˜¯çº¯ç²¹çš„å­—ç¬¦ä¸²äº†ã€‚</p>
<p>ä¸Šé¢çš„æˆå‘˜å˜é‡éƒ½æ˜¯å·²çŸ¥çš„ç±»å‹ï¼Œåªèƒ½æ¥æ”¶æŒ‡å®šçš„ç±»å‹ï¼Œæ¯”å¦‚stringç±»å‹çš„Nameåªèƒ½èµ‹å€¼stringç±»å‹çš„æ•°æ®ã€‚<br>
ä½†æœ‰æ—¶ä¸ºäº†é€šç”¨æ€§ï¼Œæˆ–ä½¿ä»£ç ç®€æ´ï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ç§ç±»å‹å¯ä»¥æ¥å—å„ç§ç±»å‹çš„æ•°æ®ï¼Œå¹¶è¿›è¡Œjsonç¼–ç ã€‚è¿™å°±ç”¨åˆ°äº†interface{}ç±»å‹ã€‚</p>
<p>å‰è¨€ï¼š<br>
interface{}ç±»å‹å…¶å®æ˜¯ä¸ªç©ºæ¥å£ï¼Œå³æ²¡æœ‰æ–¹æ³•çš„æ¥å£ã€‚goçš„æ¯ä¸€ç§ç±»å‹éƒ½å®ç°äº†è¯¥æ¥å£ã€‚å› æ­¤ï¼Œä»»ä½•å…¶ä»–ç±»å‹çš„æ•°æ®éƒ½å¯ä»¥èµ‹å€¼ç»™interface{}ç±»å‹ã€‚</p>
<pre><code>type Stu struct {
    Name  interface{} `json:&quot;name&quot;`
    Age   interface{}
    HIgh  interface{}
    sex   interface{}
    Class interface{} `json:&quot;class&quot;`
}

type Class struct {
    Name  string
    Grade int
}

func main() {
    //ä¸å‰é¢çš„ä¾‹å­ä¸€æ ·
    ......
}
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code>{&quot;name&quot;:&quot;å¼ ä¸‰&quot;,&quot;Age&quot;:18,&quot;HIgh&quot;:true,&quot;class&quot;:{&quot;Name&quot;:&quot;1ç­&quot;,&quot;Grade&quot;:3}}
</code></pre>
<p>ä»ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œæ— è®ºæ˜¯stringï¼Œintï¼Œboolï¼Œè¿˜æ˜¯æŒ‡é’ˆç±»å‹ç­‰ï¼Œéƒ½å¯èµ‹å€¼ç»™interface{}ç±»å‹ï¼Œä¸”æ­£å¸¸ç¼–ç ï¼Œæ•ˆæœä¸å‰é¢çš„ä¾‹å­ä¸€æ ·ã€‚</p>
<p>è¡¥å……ï¼š<br>
åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œç¼–ç æˆjsonä¸²çš„æ•°æ®ç»“æ„ï¼Œå¾€å¾€æ˜¯åˆ‡ç‰‡ç±»å‹ã€‚å¦‚ä¸‹å®šä¹‰äº†ä¸€ä¸ª[]StuReadç±»å‹çš„åˆ‡ç‰‡</p>
<pre><code>//æ­£ç¡®ç¤ºèŒƒ

//æ–¹å¼1ï¼šåªå£°æ˜ï¼Œä¸åˆ†é…å†…å­˜
var stus1 []*StuRead

//æ–¹å¼2ï¼šåˆ†é…åˆå§‹å€¼ä¸º0çš„å†…å­˜
stus2 := make([]*StuRead,0)

//é”™è¯¯ç¤ºèŒƒ
//new()åªèƒ½å®ä¾‹åŒ–ä¸€ä¸ªstructå¯¹è±¡ï¼Œè€Œ[]StuReadæ˜¯åˆ‡ç‰‡ï¼Œä¸æ˜¯å¯¹è±¡
stus := new([]StuRead)

stu1 := StuRead{æˆå‘˜èµ‹å€¼...}
stu2 := StuRead{æˆå‘˜èµ‹å€¼...}

//ç”±æ–¹å¼1å’Œ2åˆ›å»ºçš„åˆ‡ç‰‡ï¼Œéƒ½èƒ½æˆåŠŸè¿½åŠ æ•°æ®
//æ–¹å¼2æœ€å¥½åˆ†é…0é•¿åº¦ï¼Œappendæ—¶ä¼šè‡ªåŠ¨å¢é•¿ã€‚åä¹‹æŒ‡å®šåˆå§‹é•¿åº¦ï¼Œé•¿åº¦ä¸å¤Ÿæ—¶ä¸ä¼šè‡ªåŠ¨å¢é•¿ï¼Œå¯¼è‡´æ•°æ®ä¸¢å¤±
stus1 := appen(stus1,stu1,stu2)
stus2 := appen(stus2,stu1,stu2)

//æˆåŠŸç¼–ç 
json1,_ := json.Marshal(stus1)
json2,_ := json.Marshal(stus2)
</code></pre>
<p>è§£ç æ—¶å®šä¹‰å¯¹åº”çš„åˆ‡ç‰‡æ¥å—å³å¯</p>
<p>Json Unmarshalï¼šå°†jsonå­—ç¬¦ä¸²è§£ç åˆ°ç›¸åº”çš„æ•°æ®ç»“æ„<br>
æˆ‘ä»¬å°†ä¸Šé¢çš„ä¾‹å­è¿›è¡Œè§£ç </p>
<pre><code>type StuRead struct {
    Name  interface{} `json:&quot;name&quot;`
    Age   interface{}
    HIgh  interface{}
    sex   interface{}
    Class interface{} `json:&quot;class&quot;`
    Test  interface{}
}

type Class struct {
    Name  string
    Grade int
}

func main() {
    //jsonå­—ç¬¦ä¸­çš„&quot;å¼•å·ï¼Œéœ€ç”¨\è¿›è¡Œè½¬ä¹‰ï¼Œå¦åˆ™ç¼–è¯‘å‡ºé”™
    //jsonå­—ç¬¦ä¸²æ²¿ç”¨ä¸Šé¢çš„ç»“æœï¼Œä½†å¯¹keyè¿›è¡Œäº†å¤§å°çš„ä¿®æ”¹ï¼Œå¹¶æ·»åŠ äº†sexæ•°æ®
    data:=&quot;{\&quot;name\&quot;:\&quot;å¼ ä¸‰\&quot;,\&quot;Age\&quot;:18,\&quot;high\&quot;:true,\&quot;sex\&quot;:\&quot;ç”·\&quot;,\&quot;CLASS\&quot;:{\&quot;naME\&quot;:\&quot;1ç­\&quot;,\&quot;GradE\&quot;:3}}&quot;
    str:=[]byte(data)

    //1.Unmarshalçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯jsonå­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ¥å—jsonè§£æçš„æ•°æ®ç»“æ„ã€‚
    //ç¬¬äºŒä¸ªå‚æ•°å¿…é¡»æ˜¯æŒ‡é’ˆï¼Œå¦åˆ™æ— æ³•æ¥æ”¶è§£æçš„æ•°æ®ï¼Œå¦‚stuä»ä¸ºç©ºå¯¹è±¡StuRead{}
    //2.å¯ä»¥ç›´æ¥stu:=new(StuRead),æ­¤æ—¶çš„stuè‡ªèº«å°±æ˜¯æŒ‡é’ˆ
    stu:=StuRead{}
    err:=json.Unmarshal(str,&amp;stu)

    //è§£æå¤±è´¥ä¼šæŠ¥é”™ï¼Œå¦‚jsonå­—ç¬¦ä¸²æ ¼å¼ä¸å¯¹ï¼Œç¼º&quot;å·ï¼Œç¼º}ç­‰ã€‚
    if err!=nil{
        fmt.Println(err)
    }

    fmt.Println(stu)
}
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code>{å¼ ä¸‰ 18 true &lt;nil&gt; map[naME:1ç­ GradE:3] &lt;nil&gt;}
</code></pre>
<p>æ€»ç»“ï¼š</p>
<p>jsonå­—ç¬¦ä¸²è§£ææ—¶ï¼Œéœ€è¦ä¸€ä¸ªâ€œæ¥æ”¶ä½“â€æ¥å—è§£æåçš„æ•°æ®ï¼Œä¸”Unmarshalæ—¶æ¥æ”¶ä½“å¿…é¡»ä¼ é€’æŒ‡é’ˆã€‚å¦åˆ™è§£æè™½ä¸æŠ¥é”™ï¼Œä½†æ•°æ®æ— æ³•èµ‹å€¼åˆ°æ¥å—ä½“ä¸­ã€‚å¦‚è¿™é‡Œç”¨çš„æ˜¯StuRead{}æ¥æ”¶ã€‚</p>
<p>è§£ææ—¶ï¼Œæ¥æ”¶ä½“å¯è‡ªè¡Œå®šä¹‰ã€‚jsonä¸²ä¸­çš„keyè‡ªåŠ¨åœ¨æ¥æ”¶ä½“ä¸­å¯»æ‰¾åŒ¹é…çš„é¡¹è¿›è¡Œèµ‹å€¼ã€‚åŒ¹é…è§„åˆ™æ˜¯ï¼š</p>
<p>å…ˆæŸ¥æ‰¾ä¸keyä¸€æ ·çš„jsonæ ‡ç­¾ï¼Œæ‰¾åˆ°åˆ™èµ‹å€¼ç»™è¯¥æ ‡ç­¾å¯¹åº”çš„å˜é‡(å¦‚Name)ã€‚<br>
æ²¡æœ‰jsonæ ‡ç­¾çš„ï¼Œå°±ä»ä¸Šå¾€ä¸‹ä¾æ¬¡æŸ¥æ‰¾å˜é‡åä¸keyä¸€æ ·çš„å˜é‡ï¼Œå¦‚Ageã€‚æˆ–è€…å˜é‡åå¿½ç•¥å¤§å°å†™åä¸keyä¸€æ ·çš„å˜é‡ã€‚å¦‚HIghï¼ŒClassã€‚ç¬¬ä¸€ä¸ªåŒ¹é…çš„å°±èµ‹å€¼ï¼Œåé¢å°±ç®—æœ‰åŒ¹é…çš„ä¹Ÿå¿½ç•¥ã€‚<br>
(å‰ææ˜¯è¯¥å˜é‡å¿…éœ€æ˜¯å¯å¯¼å‡ºçš„ï¼Œå³é¦–å­—æ¯å¤§å†™)ã€‚<br>
ä¸å¯å¯¼å‡ºçš„å˜é‡æ— æ³•è¢«è§£æï¼ˆå¦‚sexå˜é‡ï¼Œè™½ç„¶jsonä¸²ä¸­æœ‰keyä¸ºsexçš„k-vï¼Œè§£æåå…¶å€¼ä»ä¸ºnil,å³ç©ºå€¼ï¼‰</p>
<p>å½“æ¥æ”¶ä½“ä¸­å­˜åœ¨jsonä¸²ä¸­åŒ¹é…ä¸äº†çš„é¡¹æ—¶ï¼Œè§£æä¼šè‡ªåŠ¨å¿½ç•¥è¯¥é¡¹ï¼Œè¯¥é¡¹ä»ä¿ç•™åŸå€¼ã€‚å¦‚å˜é‡Testï¼Œä¿ç•™ç©ºå€¼nilã€‚</p>
<p>ä½ ä¸€å®šä¼šå‘ç°ï¼Œå˜é‡Classè²Œä¼¼æ²¡æœ‰è§£æä¸ºæˆ‘ä»¬æœŸå¾…æ ·å­ã€‚å› ä¸ºæ­¤æ—¶çš„Classæ˜¯ä¸ªinterface{}ç±»å‹çš„å˜é‡ï¼Œè€Œjsonä¸²ä¸­keyä¸ºCLASSçš„valueæ˜¯ä¸ªå¤åˆç»“æ„ï¼Œä¸æ˜¯å¯ä»¥ç›´æ¥è§£æçš„ç®€å•ç±»å‹æ•°æ®ï¼ˆå¦‚â€œå¼ ä¸‰â€ï¼Œ18ï¼Œtrueç­‰ï¼‰ã€‚æ‰€ä»¥è§£ææ—¶ï¼Œç”±äºæ²¡æœ‰æŒ‡å®šå˜é‡Classçš„å…·ä½“ç±»å‹ï¼Œjsonè‡ªåŠ¨å°†valueä¸ºå¤åˆç»“æ„çš„æ•°æ®è§£æä¸ºmap[string]interface{}ç±»å‹çš„é¡¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ­¤æ—¶çš„struct Classå¯¹è±¡ä¸StuReadä¸­çš„Classå˜é‡æ²¡æœ‰åŠæ¯›é’±å…³ç³»ï¼Œæ•…ä¸è¿™æ¬¡çš„jsonè§£ææ²¡æœ‰åŠæ¯›é’±å…³ç³»ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™å‡ ä¸ªinterface{}å˜é‡è§£æåçš„ç±»å‹</p>
<pre><code>func main() {
    //ä¸å‰è¾¹jsonè§£æçš„ä»£ç ä¸€è‡´
    ...
    fmt.Println(stu) //æ‰“å°jsonè§£æå‰å˜é‡ç±»å‹
    err:=json.Unmarshal(str,&amp;stu)
    fmt.Println(&quot;--------------json è§£æå-----------&quot;)
    ... 
    fmt.Println(stu) //æ‰“å°jsonè§£æåå˜é‡ç±»å‹    
}

//åˆ©ç”¨åå°„ï¼Œæ‰“å°å˜é‡ç±»å‹
func printType(stu *StuRead){
    nameType:=reflect.TypeOf(stu.Name)
    ageType:=reflect.TypeOf(stu.Age)
    highType:=reflect.TypeOf(stu.HIgh)
    sexType:=reflect.TypeOf(stu.sex)
    classType:=reflect.TypeOf(stu.Class)
    testType:=reflect.TypeOf(stu.Test)

    fmt.Println(&quot;nameType:&quot;,nameType)
    fmt.Println(&quot;ageType:&quot;,ageType)
    fmt.Println(&quot;highType:&quot;,highType)
    fmt.Println(&quot;sexType:&quot;,sexType)
    fmt.Println(&quot;classType:&quot;,classType)
    fmt.Println(&quot;testType:&quot;,testType)
}
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code>nameType: &lt;nil&gt;
ageType: &lt;nil&gt;
highType: &lt;nil&gt;
sexType: &lt;nil&gt;
classType: &lt;nil&gt;
testType: &lt;nil&gt;
--------------json è§£æå-----------
nameType: string
ageType: float64
highType: bool
sexType: &lt;nil&gt;
classType: map[string]interface {}
testType: &lt;nil&gt;
</code></pre>
<p>ä»ç»“æœä¸­å¯è§</p>
<p>interface{}ç±»å‹å˜é‡åœ¨jsonè§£æå‰ï¼Œæ‰“å°å‡ºçš„ç±»å‹éƒ½ä¸ºnilï¼Œå°±æ˜¯æ²¡æœ‰å…·ä½“ç±»å‹ï¼Œè¿™æ˜¯ç©ºæ¥å£ï¼ˆinterface{}ç±»å‹ï¼‰çš„ç‰¹ç‚¹ã€‚</p>
<p>jsonè§£æåï¼Œjsonä¸²ä¸­valueï¼Œåªè¦æ˜¯â€ç®€å•æ•°æ®â€ï¼Œéƒ½ä¼šæŒ‰ç…§é»˜è®¤çš„ç±»å‹èµ‹å€¼ï¼Œå¦‚â€å¼ ä¸‰â€è¢«èµ‹å€¼æˆstringç±»å‹åˆ°Nameå˜é‡ä¸­ï¼Œæ•°å­—18å¯¹åº”float64ï¼Œtrueå¯¹åº”boolç±»å‹ã€‚</p>
<p>â€œç®€å•æ•°æ®â€ï¼šæ˜¯æŒ‡ä¸èƒ½å†è¿›è¡ŒäºŒæ¬¡jsonè§£æçš„æ•°æ®ï¼Œå¦‚â€nameâ€:â€å¼ ä¸‰â€åªèƒ½è¿›è¡Œä¸€æ¬¡jsonè§£æã€‚<br>
â€œå¤åˆæ•°æ®â€ï¼šç±»ä¼¼â€CLASS\â€:{\â€naME\â€:\â€1ç­\â€,\â€GradE\â€:3}è¿™æ ·çš„æ•°æ®ï¼Œæ˜¯å¯è¿›è¡ŒäºŒæ¬¡ç”šè‡³å¤šæ¬¡jsonè§£æçš„ï¼Œå› ä¸ºå®ƒçš„valueä¹Ÿæ˜¯ä¸ªå¯è¢«è§£æçš„ç‹¬ç«‹jsonã€‚å³ç¬¬ä¸€æ¬¡è§£ækeyä¸ºCLASSçš„valueï¼Œç¬¬äºŒæ¬¡è§£ævalueä¸­çš„keyä¸ºnaMEå’ŒGradEçš„value</p>
<p>å¯¹äºâ€å¤åˆæ•°æ®â€ï¼Œå¦‚æœæ¥æ”¶ä½“ä¸­é…çš„é¡¹è¢«å£°æ˜ä¸ºinterface{}ç±»å‹ï¼Œgoéƒ½ä¼šé»˜è®¤è§£ææˆmap[string]interface{}ç±»å‹ã€‚å¦‚æœæˆ‘ä»¬æƒ³ç›´æ¥è§£æåˆ°struct Classå¯¹è±¡ä¸­ï¼Œå¯ä»¥å°†æ¥å—ä½“å¯¹åº”çš„é¡¹å®šä¹‰ä¸ºè¯¥structç±»å‹ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>type StuRead struct {<br>
...<br>
//æ™®é€šstructç±»å‹<br>
Class Class <code>json:&quot;class&quot;</code><br>
//æŒ‡é’ˆç±»å‹<br>
Class *Class <code>json:&quot;class&quot;</code><br>
}</p>
<p>stuæ‰“å°ç»“æœ</p>
<p>Classç±»å‹ï¼š{å¼ ä¸‰ 18 true <nil> {1ç­ 3} <nil>}<br>
*Classç±»å‹ï¼š{å¼ ä¸‰ 18 true <nil> 0xc42008a0c0 <nil>}</p>
<p>å¯ä»¥çœ‹å‡ºï¼Œä¼ é€’Classç±»å‹çš„æŒ‡é’ˆæ—¶ï¼Œstuä¸­çš„Classå˜é‡å­˜çš„æ˜¯æŒ‡é’ˆï¼Œæˆ‘ä»¬å¯é€šè¿‡è¯¥æŒ‡é’ˆç›´æ¥è®¿é—®æ‰€å±çš„æ•°æ®ï¼Œå¦‚stu.Class.Name/stu.Class.Grade</p>
<p>Classå˜é‡è§£æåç±»å‹</p>
<p>classType: main.Class<br>
classType: *main.Class<br>
è§£ææ—¶ï¼Œå¦‚æœæ¥å—ä½“ä¸­åŒæ—¶å­˜åœ¨2ä¸ªåŒ¹é…çš„é¡¹ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ<br>
æµ‹è¯•1</p>
<p>type StuRead struct {<br>
NAme interface{}<br>
Name  interface{}<br>
NAMe interface{}    <code>json:&quot;name&quot;</code><br>
}<br>
ç»“æœ1:</p>
<pre><code>//å½“å­˜åœ¨åŒ¹é…çš„jsonæ ‡ç­¾æ—¶ï¼Œå…¶å¯¹åº”çš„é¡¹è¢«èµ‹å€¼ã€‚
//åˆ‡è®°ï¼šåŒ¹é…çš„æ ‡ç­¾å¯ä»¥æ²¡æœ‰ï¼Œä½†æœ‰æ—¶æœ€å¥½åªæœ‰ä¸€ä¸ªå“¦
{&lt;nil&gt; &lt;nil&gt; å¼ ä¸‰}
</code></pre>
<p>æµ‹è¯•2</p>
<p>type StuRead struct {<br>
NAme interface{}<br>
Name  interface{}<br>
NAMe interface{}    <code>json:&quot;name&quot;</code><br>
NamE interface{}    <code>json:&quot;name&quot;</code><br>
}<br>
ç»“æœ2</p>
<pre><code>//å½“åŒ¹é…çš„jsonæ ‡ç­¾æœ‰å¤šä¸ªæ—¶ï¼Œæ ‡ç­¾å¯¹åº”çš„é¡¹éƒ½ä¸ä¼šè¢«èµ‹å€¼ã€‚
//å¿½ç•¥æ ‡ç­¾é¡¹ï¼Œä»ä¸Šå¾€ä¸‹å¯»æ‰¾ç¬¬ä¸€ä¸ªæ²¡æœ‰æ ‡ç­¾ä¸”åŒ¹é…çš„é¡¹èµ‹å€¼
{å¼ ä¸‰ &lt;nil&gt; &lt;nil&gt; &lt;nil&gt;}
</code></pre>
<p>æµ‹è¯•3</p>
<p>type StuRead struct {<br>
NAme interface{}<br>
Name  interface{}<br>
}<br>
ç»“æœ3</p>
<pre><code>//æ²¡æœ‰jsonæ ‡ç­¾æ—¶ï¼Œä»ä¸Šå¾€ä¸‹ï¼Œç¬¬ä¸€ä¸ªåŒ¹é…çš„é¡¹ä¼šè¢«èµ‹å€¼å“¦
{å¼ ä¸‰ &lt;nil&gt;}
</code></pre>
<p>æµ‹è¯•4</p>
<pre><code>type StuRead struct {
    NAMe interface{}    `json:&quot;name&quot;`
    NamE interface{}    `json:&quot;name&quot;`
}
</code></pre>
<p>ç»“æœ4</p>
<pre><code>//å½“ç›¸åŒçš„jsonæ ‡ç­¾æœ‰å¤šä¸ªï¼Œä¸”æ²¡æœ‰ä¸å¸¦æ ‡ç­¾çš„åŒ¹é…é¡¹æ—¶ï¼ŒæŠ¥é”™äº†å“¦
# command-line-arguments
src/test/b.go:48: stu.Name undefined (type *StuRead has no field or method Name, but does have NAMe)
</code></pre>
<p>å¯è§ï¼Œä¸å‰è¾¹è¯´è¿‡çš„åŒ¹é…è§„åˆ™æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>å¦‚æœä¸æƒ³æŒ‡å®šClasså˜é‡ä¸ºå…·ä½“çš„ç±»å‹ï¼Œä»æƒ³ä¿ç•™interface{}ç±»å‹ï¼Œä½†åˆå¸Œæœ›è¯¥å˜é‡å¯ä»¥è§£æåˆ°struct Classå¯¹è±¡ä¸­ï¼Œè¿™æ—¶å€™è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>è¿™ç§éœ€æ±‚æ˜¯å¾ˆå¯èƒ½å­˜åœ¨çš„ï¼Œä¾‹å¦‚ç¬”è€…æˆ‘å°±ç¢°åˆ°äº†</p>
<p>åŠæ³•è¿˜æ˜¯æœ‰çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¯¥å˜é‡å®šä¹‰ä¸ºjson.RawMessageç±»å‹</p>
<pre><code>type StuRead struct {
    Name  interface{}
    Age   interface{}
    HIgh  interface{}
    Class json.RawMessage `json:&quot;class&quot;` //æ³¨æ„è¿™é‡Œ
}

type Class struct {
    Name  string
    Grade int
}

func main() {
    data:=&quot;{\&quot;name\&quot;:\&quot;å¼ ä¸‰\&quot;,\&quot;Age\&quot;:18,\&quot;high\&quot;:true,\&quot;sex\&quot;:\&quot;ç”·\&quot;,\&quot;CLASS\&quot;:{\&quot;naME\&quot;:\&quot;1ç­\&quot;,\&quot;GradE\&quot;:3}}&quot;
    str:=[]byte(data)
    stu:=StuRead{}
    _:=json.Unmarshal(str,&amp;stu)

    //æ³¨æ„è¿™é‡Œï¼šäºŒæ¬¡è§£æï¼
    cla:=new(Class)
    json.Unmarshal(stu.Class,cla)

    fmt.Println(&quot;stu:&quot;,stu)
    fmt.Println(&quot;string(stu.Class):&quot;,string(stu.Class))
    fmt.Println(&quot;class:&quot;,cla)
    printType(&amp;stu) //å‡½æ•°å®ç°å‰é¢ä¾‹å­æœ‰
}
</code></pre>
<p>ç»“æœ</p>
<pre><code>stu: {å¼ ä¸‰ 18 true [123 34 110 97 77 69 34 58 34 49 231 143 173 34 44 34 71 114 97 100 69 34 58 51 125]}
string(stu.Class): {&quot;naME&quot;:&quot;1ç­&quot;,&quot;GradE&quot;:3}
class: &amp;{1ç­ 3}
nameType: string
ageType: float64
highType: bool
classType: json.RawMessage
</code></pre>
<p>ä»ç»“æœä¸­å¯è§</p>
<p>æ¥æ”¶ä½“ä¸­ï¼Œè¢«å£°æ˜ä¸ºjson.RawMessageç±»å‹çš„å˜é‡åœ¨jsonè§£ææ—¶ï¼Œå˜é‡å€¼ä»ä¿ç•™jsonçš„åŸå€¼ï¼Œå³æœªè¢«è‡ªåŠ¨è§£æä¸ºmap[string]interface{}ç±»å‹ã€‚å¦‚å˜é‡Classè§£æåçš„å€¼ä¸ºï¼š{â€œnaMEâ€:â€1ç­â€,â€GradEâ€:3}</p>
<p>ä»æ‰“å°çš„ç±»å‹ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œåœ¨ç¬¬ä¸€æ¬¡jsonè§£ææ—¶ï¼Œå˜é‡Classçš„ç±»å‹æ˜¯json.RawMessageã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹è¯¥å˜é‡è¿›è¡ŒäºŒæ¬¡jsonè§£æï¼Œå› ä¸ºå…¶å€¼ä»æ˜¯ä¸ªç‹¬ç«‹ä¸”å¯è§£æçš„å®Œæ•´jsonä¸²ã€‚æˆ‘ä»¬åªéœ€å†å®šä¹‰ä¸€ä¸ªæ–°çš„æ¥å—ä½“å³å¯ï¼Œå¦‚json.Unmarshal(stu.Class,cla)</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[golangç¬”è®°-æ•°ç»„ã€åˆ‡ç‰‡ã€map]]></title>
        <id>http://lvelvis.github.io/post/golang-bi-ji-shu-zu-qie-pian-map/</id>
        <link href="http://lvelvis.github.io/post/golang-bi-ji-shu-zu-qie-pian-map/">
        </link>
        <updated>2020-05-26T05:29:04.000Z</updated>
        <content type="html"><![CDATA[<h1 id="æ•°ç»„">æ•°ç»„</h1>
<p>æ•°ç»„çš„é•¿åº¦ä¸€æ—¦å®šä¹‰äº†å°±ä¸èƒ½åŠ¨æ€å¢é•¿ï¼Œå¹¶ä¸”å­˜å‚¨çš„æ•°æ®ç±»å‹å¿…é¡»ç›¸åŒã€‚</p>
<h2 id="åˆ›å»ºæ–¹æ³•">åˆ›å»ºæ–¹æ³•ï¼š</h2>
<p>var æ•°ç»„å [é•¿åº¦]æ•°æ®ç±»å‹<br>
ä¾‹å¦‚ï¼š</p>
<pre><code>package main
import &quot;fmt&quot;
 
func main(){
    var test [5]int //å®šä¹‰æ•°ç»„åå­—testï¼Œé•¿åº¦ä¸º5ï¼Œæ•°æ®ç±»å‹ä¸ºintçš„æ•°ç»„
    test[0] = 1    //èµ‹å€¼
    test[1] = 2   
    test[2] = 3
    test[3] = 4
    fmt.Println(test) 
    fmt.Println(test[2])
    fmt.Println(test[1:3]) //è¾“å‡º1åˆ°3çš„æ•°ç»„
    fmt.Println(test[0:]) //0åˆ°ç»“å°¾
    fmt.Println(test[:3])  //0åˆ°3
 
}
</code></pre>
<pre><code>##ç»“æœ##
[1 2 3 4 0]
3
[2 3]
[1 2 3 4 0]
[1 2 3]
</code></pre>
<h2 id="æ•°ç»„çš„å››ç§åˆå§‹åŒ–æ–¹å¼">æ•°ç»„çš„å››ç§åˆå§‹åŒ–æ–¹å¼</h2>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code>var s1 [3]int = [3]int{1,2,3}
fmt.Println(&quot;s1&quot;,s1)
var s2 [4]int = [...]int{5,6,7,8} //[...]æ˜¯å›ºå®šå†™æ³•
fmt.Println(&quot;s2&quot;,s2)
var s3 = [2]int{9,10} //ç¬¬ä¸€ç§çš„ç®€åŒ–
fmt.Println(&quot;s3&quot;,s3)
var s4 = [...]int{3:43,1:41,0:40,2:42} //ç±»ä¼¼é”®å€¼å¯¹
fmt.Println(&quot;s4&quot;,s4)
var s5 = new([5]int)
s5[4] =12
fmt.Println(&quot;s5&quot;,s5)
</code></pre>
<pre><code>##ç»“æœ##
s1 [1 2 3]
s2 [5 6 7 8]
s3 [9 10]
s4 [40 41 42 43]
s5 [0 0 0 0 5]
</code></pre>
<h2 id="æ•°ç»„çš„éå†">æ•°ç»„çš„éå†</h2>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code>var s4 = [...]int{3:43,1:41,0:40,2:42} //ç±»ä¼¼é”®å€¼å¯¹
fmt.Println(&quot;s4&quot;,s4)
     
for index,value := range s4{
fmt.Println(index,value)
}
 
#ç»“æœ##
0 40
1 41
2 42
3 43
</code></pre>
<pre><code>var s4 = [...]int{3:43,1:41,0:40,2:42} //ç±»ä¼¼é”®å€¼å¯¹
for i := 0;i &lt;len(s4);i++{
fmt.Println(i,s4[i])
}
 
#ç»“æœ##
0 40
1 41
2 42
3 43
</code></pre>
<h1 id="sliceåˆ‡ç‰‡">sliceåˆ‡ç‰‡</h1>
<p>1ã€åˆ‡ç‰‡æ˜¯æ•°ç»„çš„å¼•ç”¨(åˆ‡ç‰‡æ˜¯æ•°ç»„çš„ä¸€éƒ¨åˆ†)<br>
2ã€åˆ‡ç‰‡çš„ä½¿ç”¨ç±»ä¼¼æ•°ç»„ï¼Œå¦‚éå†<br>
3ã€åˆ‡ç‰‡çš„é•¿åº¦æ˜¯å¯å˜çš„</p>
<h2 id="åˆ›å»ºè¯­æ³•">åˆ›å»ºè¯­æ³•</h2>
<p>var åˆ‡ç‰‡å []ç±»å‹<br>
å¦‚ï¼š</p>
<pre><code>var qiepian []int
</code></pre>
<h2 id="åˆ‡ç‰‡ç¤ºä¾‹">åˆ‡ç‰‡ç¤ºä¾‹:</h2>
<pre><code>###ä¾‹å­ä¸€&lt;br&gt;var suzhu [4]int = [...]int{5,6,7,8}
slice := suzhu[1:4] //1åˆ°4çš„å€¼ï¼Œä¸åŒ…å«4
fmt.Println(suzhu)
fmt.Println(slice)
fmt.Println(&quot;åˆ‡ç‰‡çš„å®¹é‡&quot;,cap(slice))
 
##ç»“æœ
[5 6 7 8]
[6 7 8]
åˆ‡ç‰‡çš„å®¹é‡ 3&lt;br&gt;&lt;br&gt;
###ä¾‹å­äºŒã€ä½¿ç”¨makeåˆ›å»ºåˆ‡ç‰‡
var slice []int = make([]int,4,10) //ç±»å‹ï¼Œå¤§å°(é•¿åº¦),å®¹é‡ï¼ˆå¯é€‰ï¼‰ï¼Œå®¹é‡å¿…é¡»å¤§äºé•¿åº¦
slice[0] = 10
slice[1] = 11
fmt.Println(slice)
 
##ç»“æœ##
[10 11 0 0]
 
 
###ä¾‹å­ä¸‰
var slice []int = []int {2,4,6}
fmt.Println(slice)
 
##ç»“æœ##
2 4 6
</code></pre>
<h2 id="åˆ‡ç‰‡çš„appendè¿½åŠ ">åˆ‡ç‰‡çš„appendè¿½åŠ </h2>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code>var slice []int = []int {2,4,6}
fmt.Println(slice)
//ä½¿ç”¨appendç›´æ¥è¿½åŠ åˆ‡ç‰‡å†…å®¹ï¼ˆç±»ä¼¼python listçš„appendï¼‰
slice = append(slice,8,10)
fmt.Println(slice)
slice = append(slice,slice...) //è¿½åŠ åˆ‡ç‰‡ï¼Œ...æ˜¯å›ºå®šå†™æ³•
fmt.Println(slice)
 
###ç»“æœ###
[2 4 6]
[2 4 6 8 10]
[2 4 6 8 10 2 4 6 8 10]
</code></pre>
<h2 id="åˆ‡ç‰‡çš„copyæ“ä½œ">åˆ‡ç‰‡çš„copyæ“ä½œ</h2>
<p>ä½¿ç”¨copyå†…ç½®å‡½æ•°<br>
ä¾‹å¦‚:</p>
<pre><code>var slice []int = []int {2,4,6}
fmt.Println(slice)
var slice2 []int = make([]int,5)
fmt.Println(slice2)
copy(slice2,slice) //å°†sliceå¤åˆ¶ç»™slice2
fmt.Println(slice)
fmt.Println(slice2)
 
##ç»“æœ##
[2 4 6]
[0 0 0 0 0]
[2 4 6]
[2 4 6 0 0]
</code></pre>
<h2 id="ä½¿ç”¨åˆ‡ç‰‡æ”¹å˜å­—ç¬¦ä¸²çš„å†…å®¹">ä½¿ç”¨åˆ‡ç‰‡æ”¹å˜å­—ç¬¦ä¸²çš„å†…å®¹</h2>
<pre><code>var str string = &quot;hello&quot;
fmt.Println(str)
arr := []byte(str)
arr[1] = 'a' //è½¬æˆå­—ç¬¦ä¸²
arr1 := []rune(str) //ä¸­æ–‡è½¬æ¢
arr1[0] = 'ç‹—'
fmt.Println(arr)
str = string(arr)
fmt.Println(str)
str = string(arr1)
fmt.Println(str)
 
##ç»“æœ##
hello
[104 97 108 108 111]
hello
ç‹—hello
</code></pre>
<h1 id="map">map</h1>
<p>mapæ˜¯key-valueæ•°æ®ç»“æ„(ç±»ä¼¼pythonçš„dict)<br>
mapæ˜¯æ— åºå­˜å‚¨çš„</p>
<p>åˆ›å»ºmapè¯­æ³•<br>
var map å˜é‡å map[keytype]valuetype</p>
<p>å¦‚ï¼š</p>
<pre><code>var m1 map[string]string
var m2 map[string]int
var m3 map[int]string
var m4 map[string]map[string]string
```ã€€ã€€

ä½¿ç”¨ä¾‹å­ï¼š
</code></pre>
<p>package main<br>
import &quot;fmt&quot;</p>
<p>func main(){<br>
var m1 map[string]string<br>
//åœ¨ä½¿ç”¨mapå‰,éœ€è¦å…ˆmakeï¼Œmakeçš„ä½œç”¨æŠ€æœ¯ç»™mapåˆ†é…æ•°æ®ç©ºé—´<br>
m1 = make(map[string]string)<br>
m2 := map[string]string{  //ä½¿ç”¨æ–¹å¼äºŒ<br>
&quot;a1&quot; : &quot;q1&quot;,<br>
&quot;a2&quot; : &quot;a2&quot;,<br>
}<br>
m1[&quot;s1&quot;] = &quot;äºšç´¢&quot;<br>
m1[&quot;s2&quot;] = &quot;ç›–ä¼¦&quot;<br>
fmt.Println(m1)<br>
fmt.Println(m1[&quot;s1&quot;])<br>
fmt.Println(m2)<br>
}</p>
<p>###ç»“æœ###<br>
map[s1:äºšç´¢ s2:ç›–ä¼¦]<br>
äºšç´¢<br>
map[a1:q1 a2:a2]</p>
<pre><code>
 

mapçš„å¢åˆ æ”¹æŸ¥
å¢ã€æ”¹
map[key] = value //æ²¡æœ‰å°±å¢åŠ ï¼Œå­˜åœ¨å°±ä¿®æ”¹

åˆ 
delete(map,key)

æŸ¥
map[key]   //å¯¹åº”çš„valueï¼Œå’Œpythonçš„dictä¸€æ ·</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[k8s hpaå¼¹æ€§æ‰©å®¹é…ç½®]]></title>
        <id>http://lvelvis.github.io/post/k8s-hpa-dan-xing-kuo-rong-pei-zhi/</id>
        <link href="http://lvelvis.github.io/post/k8s-hpa-dan-xing-kuo-rong-pei-zhi/">
        </link>
        <updated>2020-05-19T05:24:13.000Z</updated>
        <content type="html"><![CDATA[<pre><code>HPAå…¨ç§°Horizontal Pod Autoscalingï¼Œæ˜¯K8så®ç°podè‡ªåŠ¨æ°´å¹³æ‰©å®¹ç¼©å®¹çš„ç‰¹æ€§ï¼Œè¿™ä¸ªç‰¹æ€§ä½¿æ•´ä¸ªkubernetesé›†ç¾¤é©¬ä¸Šé«˜å¤§ä¸Šèµ·æ¥äº†ã€‚
è¦ä½¿ç”¨HPAä¹Ÿä¸æ˜¯è¿™ä¹ˆç®€å•çš„ï¼ŒHPA apiåˆ†v1ã€v2beta1ã€v2bate2ä¸‰ç§ï¼Œv1åªæ”¯æŒé€šè¿‡CPUè¡¡é‡æ‰©ç¼©å®¹ï¼Œv2bate1åŠ å…¥é’ˆå¯¹å†…å­˜ä½œä¸ºåº¦é‡ï¼Œv2bate2å¯ä»¥ç”¨customer metricsä¾‹å¦‚ç½‘ç»œç­‰ï¼Œæ‰€ä»¥v2bate1å¼€å§‹æ‰æ¯”è¾ƒå®ç”¨ã€‚
</code></pre>
<p>è¦ä½¿ç”¨HPAå¿…é¡»è¦å¼€å¯ä»¥ä¸‹ä¸¤ä¸ªç‰¹æ€§ï¼š</p>
<p>Aggregation Layer èšåˆå±‚ï¼Œé€šè¿‡ä¸æ ¸å¿ƒçš„apiserveråˆ†ç¦»ï¼Œå®ç°è‡ªå®šä¹‰çš„æ‰©å±•åŠŸèƒ½<br>
metrics-server æ•°æ®æ”¶é›†ï¼Œèƒ½å¤Ÿæ”¶é›†podã€nodeç­‰å®æ—¶è¿è¡ŒæŒ‡æ ‡ï¼ˆcpuã€å†…å­˜ï¼‰ï¼Œç»™k8sé›†ç¾¤ä½¿ç”¨ï¼Œä¾‹å¦‚kubectl topå‘½ä»¤ã€HPA<br>
æ¯”è¾ƒè€çš„ç‰ˆæœ¬ä½¿ç”¨heapster</p>
<h1 id="aggregation-layer">Aggregation Layer</h1>
<p>è¦æ‰“å¼€Aggregation Layerï¼Œéœ€è¦é…ç½®ä¸€ä¸‹apiserverï¼Œå¢åŠ ç›¸å…³è®¤è¯è¯ä¹¦ã€‚è®¤è¯æµç¨‹æ˜¯clientå‘èµ·è¯·æ±‚åˆ°apiserverï¼Œapiserverä¸aggergated apiserverå»ºç«‹tlså®‰å…¨é“¾æ¥ï¼ŒæŠŠè¯·æ±‚proxyåˆ°aggergated apiserverï¼Œç»§ç»­è¿›è¡Œâ€“requestheader-*å‚æ•°çš„ç›¸å…³è®¤è¯ã€‚</p>
<p>è®¤è¯æµç¨‹<br>
<img src="http://lvelvis.github.io/post-images/1589865988979.png" alt="" loading="lazy"></p>
<p>éœ€è¦ç”Ÿæˆaggregateä½¿ç”¨çš„è¯ä¹¦ï¼Œå‚è€ƒcfsslç”Ÿæˆè¯ä¹¦æ–¹æ³•ï¼Œproxy-client-cert-fileçš„CNéœ€è¦ä¸requestheader-allowed-namesåŒ¹é…ã€‚<br>
åœ¨apiserverå¢åŠ å¦‚ä¸‹å¯åŠ¨å‚æ•°</p>
<pre><code>--requestheader-client-ca-file=/etc/kubernetes/pki/agg-ca.pem
--proxy-client-cert-file=/etc/kubernetes/pki/aggregate.pem
--proxy-client-key-file=/etc/kubernetes/pki/aggregate-key.pem
--requestheader-allowed-names=aggregator
--requestheader-extra-headers-prefix=X-Remote-Extra-
--requestheader-group-headers=X-Remote-Group
--requestheader-username-headers=X-Remote-User
#å¦‚æœkube-proxyæ²¡æœ‰åœ¨Masterä¸Šé¢è¿è¡Œï¼Œè¿˜éœ€è¦é…ç½®
--enable-aggregator-routing=true
</code></pre>
<h1 id="metrics-server">metrics server</h1>
<p>ä»k8s 1.8å¼€å§‹ï¼Œé›†ç¾¤çš„èµ„æºä½¿ç”¨æƒ…å†µéƒ½é€šè¿‡metrics apiæ”¶é›†ï¼Œä¾‹å¦‚å®¹å™¨CPUã€å†…å­˜ã€‚è¿™äº›æŒ‡æ ‡å¯ç”¨äºkuberctl topæˆ–è€…k8sçš„HPAç­‰ç‰¹æ€§ã€‚<br>
metrice serverå¯ä»¥åœ¨githubæ‰¾åˆ°å¹¶éƒ¨ç½²</p>
<pre><code>git clone https://github.com/kubernetes-incubator/metrics-server
cd metrics-server
kubectl create -f deploy/1.8+/
</code></pre>
<pre><code>æ³¨1ï¼šmetrics-serveré»˜è®¤ä½¿ç”¨nodeçš„ä¸»æœºåï¼Œä½†æ˜¯corednsé‡Œé¢æ²¡æœ‰ç‰©ç†æœºä¸»æœºåçš„è§£æï¼Œä¸€ç§æ˜¯éƒ¨ç½²çš„æ—¶å€™æ·»åŠ ä¸€ä¸ªå‚æ•°ï¼š â€“kubelet-preferred-address-types=InternalIP,Hostname,InternalDNS,ExternalDNS,ExternalIP,ç¬¬äºŒç§æ˜¯ä½¿ç”¨dnsmasqæ„å»ºä¸€ä¸ªä¸Šæ¸¸çš„dnsæœåŠ¡
æ³¨2ï¼škubelet çš„10250ç«¯å£ä½¿ç”¨çš„æ˜¯httpsåè®®ï¼Œè¿æ¥éœ€è¦éªŒè¯tlsè¯ä¹¦ã€‚å¯ä»¥åœ¨metrics serverå¯åŠ¨å‘½ä»¤æ·»åŠ å‚æ•°â€“kubelet-insecure-tlsä¸éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦
æ³¨3ï¼šyamlæ–‡ä»¶ä¸­çš„imageåœ°å€k8s.gcr.io/metrics-server-amd64:v0.3.3 éœ€è¦æ¢¯å­ï¼Œéœ€è¦æ”¹æˆä¸­å›½å¯ä»¥è®¿é—®çš„imageåœ°å€ï¼Œå¯ä»¥ä½¿ç”¨aliyunçš„ã€‚è¿™é‡Œä½¿ç”¨hub.docker.comé‡Œçš„googleé•œåƒåœ°å€ image: mirrorgooglecontainers/metrics-server-amd64:v0.3.3
</code></pre>
<p>æˆåŠŸè¿è¡Œkubectl topå‘½ä»¤</p>
<pre><code>ubuntu@k8s-dev-m1:~/k8sssl/agglayer$ kubectl top nodes
NAME                   CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%   
k8s-dev-node2          103m         5%      2696Mi                 72%       
k8s-dev-node3.bxr.cn   115m      2%     5312Mi                  67%  
k8s-dev-node4          57m          2%       2634Mi                  70%     
k8s-dev-node5          148m         7%       2443Mi                  65%
</code></pre>
<h1 id="hpa">HPA</h1>
<pre><code>æœ‰äº†metricså°±å¯ä»¥å¼€å§‹ä½¿ç”¨HPAç‰¹æ€§äº†ã€‚hpaæœ‰å‡ ä¸ªç‰¹ç‚¹
deployæˆ–è€…rsç­‰éœ€è¦è®¾ç½®resourcesæ‰èƒ½ä½¿ç”¨hpa
å¦‚æœæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªHPA controllerï¼Œå®ƒä¼šæ¯éš”15sï¼ˆå¯ä»¥é€šè¿‡â€“horizontal-pod-autoscaler-sync-periodä¿®æ”¹ï¼‰æ£€æµ‹ä¸€æ¬¡hpaå®šä¹‰çš„èµ„æºä¸å®é™…èµ„æºä½¿ç”¨æƒ…å†µï¼Œå¦‚æœè¾¾åˆ°é˜€å€¼å°±ä¼šè°ƒæ•´podæ•°é‡ã€‚
HPAè®¾ç½®çš„é˜€å€¼ä¸æ˜¯ç»å¯¹çš„ï¼Œå…è®¸è®¾ç½®ä¸€ä¸ªæµ®åŠ¨èŒƒå›´ï¼Œâ€“horizontal-pod-autoscaler-toleranceé»˜è®¤æ˜¯0.1
podè°ƒæ•´ç®—æ³• desiredReplicas = ceil[currentReplicas * ( currentMetricValue / desiredMetricValue )]
scaleæœ‰ä¸€ä¸ªçª—å£æœŸï¼ŒæœŸé—´æ¯æ¬¡å˜åŒ–ä¼šè®°å½•ä¸‹æ¥ï¼Œé€‰æ‹©æœ€ä¼˜çš„è°ƒæ•´å»ºè®®å†è¿›è¡Œscaleï¼Œè¿™æ ·å¯ä»¥ä¿è¯èµ„æºå¹³æ»‘å˜åŠ¨ï¼Œé€šè¿‡â€“horizontal-pod-autoscaler-downscale-stabilizationè®¾å®šï¼Œé»˜è®¤5åˆ†é’Ÿã€‚
é€šè¿‡hpaè°ƒæ•´æ–°å¢çš„podä¸ä¼šé©¬ä¸Šreadyï¼Œè¿™æ—¶å€™æ”¶é›†çš„metricså°±ä¸å‡†ï¼Œä¸ºäº†å‡å°‘å½±å“ï¼Œhpaä¸€å¼€å§‹ä¸ä¼šæ”¶é›†æ–°podçš„metricsã€‚é€šè¿‡â€“horizontal-pod-autoscaler-initial-readiness-delayï¼ˆé»˜è®¤30sï¼‰å’Œ â€“horizontal-pod-autoscaler-cpu-initialization-periodï¼ˆé»˜è®¤ä¸º 5 åˆ†é’Ÿï¼‰è°ƒæ•´
</code></pre>
<p><img src="http://lvelvis.github.io/post-images/1589866316410.svg" alt="" loading="lazy"><br>
ç¤ºä¾‹hpa.yml:</p>
<pre><code>apiVersion: autoscaling/v2beta2
kind: HorizontalPodAutoscaler
metadata:
  name: hpa-test
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: podinfo
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 75
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization 
        averageUtilization: 160
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹åŒ…æ‹¬cpuå’ŒmemoryæŒ‡æ ‡ï¼ŒaverageUtilizationè¿™ä¸ªç™¾åˆ†æ¯”æ˜¯æ ¹æ®deploymentçš„resources.requestsè®¡ç®—çš„ã€‚ä¾‹å¦‚æœ‰deploymenté™åˆ¶requestsæ˜¯512Miï¼Œreplicasæ˜¯2ï¼Œå®é™…pod1ç”¨äº†612Miï¼Œpod2ç”¨äº†598Miï¼Œè®¡ç®—å…¬å¼æ˜¯ (612+598)/2/512 = 118%</p>
<p>æŸ¥çœ‹hpaçš„æƒ…å†µï¼Œtargetsç¬¬ä¸€ä¸ªæ˜¯memoryï¼Œç¬¬äºŒä¸ªæ˜¯cpuæŒ‡æ ‡ï¼ŒREPLICASæ˜¯æ ¹æ®è®¡ç®—åçš„å½“å‰podæ•°</p>
<pre><code>ubuntu@k8s-m1:~/k8s/hpa$ kubectl get hpa
NAME       REFERENCE            TARGETS             MINPODS   MAXPODS   REPLICAS   AGE
hpa-test   Deployment/podinfo   120%/160%, 6%/75%   2         4         3          97m
</code></pre>
<p>å®˜æ–¹ç¤ºä¾‹è¿˜åŒ…æ‹¬packets-per-secondã€requests-per-secondè¿™äº›æŒ‡æ ‡ï¼Œéœ€è¦è¿›ä¸€æ­¥éªŒè¯</p>
<pre><code>apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  name: php-apache
  namespace: default
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: php-apache
  minReplicas: 1
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: AverageUtilization
        averageUtilization: 50
  - type: Pods
    pods:
      metric:
        name: packets-per-second
      targetAverageValue: 1k
  - type: Object
    object:
      metric:
        name: requests-per-second
      describedObject:
        apiVersion: networking.k8s.io/v1beta1
        kind: Ingress
        name: main-route
      target:
        kind: Value
        value: 10k
status:
  observedGeneration: 1
  lastScaleTime: &lt;some-time&gt;
  currentReplicas: 1
  desiredReplicas: 1
  currentMetrics:
  - type: Resource
    resource:
      name: cpu
    current:
      averageUtilization: 0
      averageValue: 0
  - type: Object
    object:
      metric:
        name: requests-per-second
      describedObject:
        apiVersion: networking.k8s.io/v1beta1
        kind: Ingress
        name: main-route
      current:
        value: 10k

</code></pre>
<p><a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/#create-horizontal-pod-autoscaler">å®˜æ–¹hpaå‚æ•°</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[beegoé™æ€æ–‡ä»¶åŠ è½½è·¯å¾„ä¿®æ”¹]]></title>
        <id>http://lvelvis.github.io/post/beego-jing-tai-wen-jian-jia-zai-lu-jing-xiu-gai/</id>
        <link href="http://lvelvis.github.io/post/beego-jing-tai-wen-jian-jia-zai-lu-jing-xiu-gai/">
        </link>
        <updated>2020-05-11T04:49:08.000Z</updated>
        <content type="html"><![CDATA[<p>Go è¯­è¨€å†…éƒ¨å…¶å®å·²ç»æä¾›äº† http.ServeFileï¼Œé€šè¿‡è¿™ä¸ªå‡½æ•°å¯ä»¥å®ç°é™æ€æ–‡ä»¶çš„æœåŠ¡ã€‚</p>
<p>beego é’ˆå¯¹è¿™ä¸ªåŠŸèƒ½è¿›è¡Œäº†ä¸€å±‚å°è£…ï¼Œé€šè¿‡ä¸‹é¢çš„æ–¹å¼è¿›è¡Œé™æ€æ–‡ä»¶æ³¨å†Œï¼š</p>
<pre><code>beego.SetStaticPath(&quot;/static&quot;,&quot;public&quot;)
</code></pre>
<p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è·¯å¾„ï¼Œurl è·¯å¾„ä¿¡æ¯<br>
ç¬¬äºŒä¸ªå‚æ•°æ˜¯é™æ€æ–‡ä»¶ç›®å½•ï¼ˆç›¸å¯¹åº”ç”¨æ‰€åœ¨çš„ç›®å½•ï¼‰<br>
beego æ”¯æŒå¤šä¸ªç›®å½•çš„é™æ€æ–‡ä»¶æ³¨å†Œï¼Œç”¨æˆ·å¯ä»¥æ³¨å†Œå¦‚ä¸‹çš„é™æ€æ–‡ä»¶ç›®å½•ï¼š</p>
<pre><code>beego.SetStaticPath(&quot;/images&quot;,&quot;images&quot;)
beego.SetStaticPath(&quot;/css&quot;,&quot;css&quot;)
beego.SetStaticPath(&quot;/js&quot;,&quot;js&quot;)
```ã€€ã€€

è®¾ç½®äº†å¦‚ä¸Šçš„é™æ€ç›®å½•ä¹‹åï¼Œç”¨æˆ·è®¿é—® /images/login/login.pngï¼Œé‚£ä¹ˆå°±ä¼šè®¿é—®åº”ç”¨å¯¹åº”çš„ç›®å½•ä¸‹é¢çš„ images/login/login.png æ–‡ä»¶ã€‚

å¦‚æœæ˜¯è®¿é—® /static/img/logo.pngï¼Œé‚£ä¹ˆå°±è®¿é—® public/img/logo.pngæ–‡ä»¶ã€‚

é»˜è®¤æƒ…å†µä¸‹ beego ä¼šåˆ¤æ–­ç›®å½•ä¸‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨ç›´æ¥è¿”å› 404 é¡µé¢ï¼Œå¦‚æœè¯·æ±‚çš„æ˜¯ index.htmlï¼Œé‚£ä¹ˆç”±äº http.ServeFile é»˜è®¤æ˜¯ä¼šè·³è½¬çš„ï¼Œä¸æä¾›è¯¥é¡µé¢çš„æ˜¾ç¤ºã€‚

å› æ­¤ beego å¯ä»¥è®¾ç½® beego.BConfig.WebConfig.DirectoryIndex=true è¿™æ ·æ¥ä½¿å¾—æ˜¾ç¤º index.html é¡µé¢ã€‚è€Œä¸”å¼€å¯è¯¥åŠŸèƒ½ä¹‹åï¼Œç”¨æˆ·è®¿é—®ç›®å½•å°±ä¼šæ˜¾ç¤ºè¯¥ç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶åˆ—è¡¨ã€‚</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ç”¨æˆ·ç©ºé—´æŒ‚è½½ CEPH æ–‡ä»¶ç³»ç»Ÿ]]></title>
        <id>http://lvelvis.github.io/post/yong-hu-kong-jian-gua-zai-ceph-wen-jian-xi-tong/</id>
        <link href="http://lvelvis.github.io/post/yong-hu-kong-jian-gua-zai-ceph-wen-jian-xi-tong/">
        </link>
        <updated>2020-05-08T06:03:36.000Z</updated>
        <content type="html"><![CDATA[<p>Ceph v0.55 åŠåç»­ç‰ˆæœ¬é»˜è®¤å¼€å¯äº† cephx è®¤è¯ã€‚ä»ç”¨æˆ·ç©ºé—´ï¼ˆ FUSE ï¼‰æŒ‚è½½ä¸€ Ceph æ–‡ä»¶ç³»ç»Ÿå‰ï¼Œç¡®ä¿å®¢æˆ·ç«¯ä¸»æœºæœ‰ä¸€ä»½ Ceph é…ç½®å‰¯æœ¬ã€å’Œå…·å¤‡ Ceph å…ƒæ•°æ®æœåŠ¡å™¨èƒ½åŠ›çš„å¯†é’¥ç¯ã€‚</p>
<p>1ã€ åœ¨å®¢æˆ·ç«¯ä¸»æœºä¸Šï¼ŒæŠŠç›‘è§†å™¨ä¸»æœºä¸Šçš„ Ceph é…ç½®æ–‡ä»¶æ‹·è´åˆ° /etc/ceph/ ç›®å½•ä¸‹</p>
<pre><code>sudo mkdir -p /etc/ceph
sudo scp {user}@{server-machine}:/etc/ceph/ceph.conf /etc/ceph/ceph.conf
</code></pre>
<p>2ã€ åœ¨å®¢æˆ·ç«¯ä¸»æœºä¸Šï¼ŒæŠŠç›‘è§†å™¨ä¸»æœºä¸Šçš„ Ceph å¯†é’¥ç¯æ‹·è´åˆ° /etc/ceph ç›®å½•ä¸‹</p>
<pre><code>sudo scp {user}@{server-machine}:/etc/ceph/ceph.keyring /etc/ceph/ceph.keyring
</code></pre>
<p>3ã€ ç¡®ä¿å®¢æˆ·ç«¯æœºå™¨ä¸Šçš„ Ceph é…ç½®æ–‡ä»¶å’Œå¯†é’¥ç¯éƒ½æœ‰åˆé€‚çš„æƒé™ä½ï¼Œå¦‚ chmod 644 ã€‚<br>
cephx å¦‚ä½•é…ç½®è¯·å‚è€ƒ CEPHX é…ç½®å‚è€ƒã€‚<br>
è¦æŠŠ Ceph æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ä¸ºç”¨æˆ·ç©ºé—´æ–‡ä»¶ç³»ç»Ÿï¼Œå¯ä»¥ç”¨ ceph-fuse å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code>sudo mkdir /home/usernname/cephfs
sudo ceph-fuse -m 192.168.0.1:6789 /home/username/cephfs
</code></pre>
<p>è¯¦æƒ…è§ <a href="http://docs.ceph.org.cn/man/8/ceph-fuse/">ceph-fuse</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[linuxå¦‚ä½•å¯¼å…¥è‡ªå®šä¹‰è¯ä¹¦]]></title>
        <id>http://lvelvis.github.io/post/linux-ru-he-dao-ru-zi-ding-yi-zheng-shu/</id>
        <link href="http://lvelvis.github.io/post/linux-ru-he-dao-ru-zi-ding-yi-zheng-shu/">
        </link>
        <updated>2020-05-06T08:33:15.000Z</updated>
        <content type="html"><![CDATA[<h1 id="é—®é¢˜">é—®é¢˜</h1>
<pre><code>curl https://192.168.0.200:8443
æç¤ºcurl: (60) Peer's Certificate issuer is not recognized.
curl: (60) Peer's Certificate issuer is not recognized.
More details here: http://curl.haxx.se/docs/sslcerts.html

curl performs SSL certificate verification by default, using a &quot;bundle&quot;
 of Certificate Authority (CA) public keys (CA certs). If the default
 bundle file isn't adequate, you can specify an alternate file
 using the --cacert option.
If this HTTPS server uses a certificate signed by a CA represented in
 the bundle, the certificate verification probably failed due to a
 problem with the certificate (it might be expired, or the name might
 not match the domain name in the URL).
If you'd like to turn off curl's verification of the certificate, use
 the -k (or --insecure) option.
</code></pre>
<h1 id="mac-os-x">Mac OS X</h1>
<h2 id="æ·»åŠ è¯ä¹¦">æ·»åŠ è¯ä¹¦ï¼š</h2>
<pre><code>sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain ~/new-root-certificate.crt
</code></pre>
<h2 id="ç§»é™¤è¯ä¹¦">ç§»é™¤è¯ä¹¦ï¼š</h2>
<pre><code>sudo security delete-certificate -c &quot;&lt;name of existing certificate&gt;&quot;
</code></pre>
<h1 id="windows">Windows</h1>
<h2 id="æ·»åŠ è¯ä¹¦-2">æ·»åŠ è¯ä¹¦ï¼š</h2>
<pre><code>certutil -addstore -f &quot;ROOT&quot; new-root-certificate.crt
</code></pre>
<h2 id="ç§»é™¤è¯ä¹¦-2">ç§»é™¤è¯ä¹¦ï¼š</h2>
<pre><code>certutil -delstore &quot;ROOT&quot; serial-number-hex
</code></pre>
<h1 id="linux-ubuntu-debian">Linux (Ubuntu, Debian)</h1>
<h2 id="æ·»åŠ è¯ä¹¦-3">æ·»åŠ è¯ä¹¦ï¼š</h2>
<pre><code>å¤åˆ¶ CA æ–‡ä»¶åˆ°ç›®å½•ï¼š /usr/local/share/ca-certificates/
æ‰§è¡Œ:
sudo cp foo.crt /usr/local/share/ca-certificates/foo.crt
</code></pre>
<h2 id="æ›´æ–°-ca-è¯ä¹¦åº“">æ›´æ–° CA è¯ä¹¦åº“:</h2>
<pre><code>sudo update-ca-certificates
</code></pre>
<h2 id="ç§»é™¤è¯ä¹¦-3">ç§»é™¤è¯ä¹¦ï¼š</h2>
<pre><code>Remove your CA.

Update the CA store:

sudo update-ca-certificates --fresh

Restart Kerio Connect to reload the certificates in the 32-bit versions or Debian 7.
</code></pre>
<h1 id="linux-centos-6">Linux (CentOs 6)</h1>
<h2 id="æ·»åŠ è¯ä¹¦-4">æ·»åŠ è¯ä¹¦ï¼š</h2>
<p>// root-ca.crt ä¸ºcaè¯ä¹¦</p>
<pre><code>å®‰è£… ca-certificates package:

yum install ca-certificates

å¯ç”¨dynamic CA configuration feature:

update-ca-trust force-enable

Add it as a new file to /etc/pki/ca-trust/source/anchors/:
cp root-ca.crt /etc/pki/ca-trust/source/anchors/

æ‰§è¡Œ:

update-ca-trust extract

Restart Kerio Connect to reload the certificates in the 32-bit version.
</code></pre>
<h1 id="linux-centos-5">Linux (CentOs 5)</h1>
<h2 id="æ·»åŠ è¯ä¹¦-5">æ·»åŠ è¯ä¹¦ï¼š</h2>
<pre><code>Append your trusted certificate to file /etc/pki/tls/certs/ca-bundle.crt

cat foo.crt &gt;&gt; /etc/pki/tls/certs/ca-bundle.crt
</code></pre>
<h1 id="æµ‹è¯•è®¿é—®">æµ‹è¯•è®¿é—®</h1>
<pre><code> curl -v &quot;https:/gitlab.test.com/micro-lib/server?go-get=1&quot;
</code></pre>
]]></content>
    </entry>
</feed>